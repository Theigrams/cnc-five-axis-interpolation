{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"cnc_five_axis_interpolation","text":"<p>\u57fa\u4e8e Yuen et al. (2013) \u7684 C\u00b3 \u8fde\u7eed\u4e94\u8f74\u8f68\u8ff9\u751f\u6210\u7b97\u6cd5\u5b9e\u73b0\u3002</p>"},{"location":"#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u5305\u5b9e\u73b0\u4e86\u8bba\u6587 \"Smooth trajectory generation for five-axis machine tools\" \u4e2d\u7684\u6838\u5fc3\u7b97\u6cd5\uff0c\u5305\u62ec\uff1a</p> <ul> <li>C\u00b3 \u8fde\u7eed\u4f4d\u7f6e\u6837\u6761\uff1a\u4e94\u6b21 B \u6837\u6761 + 9 \u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f</li> <li>C\u00b3 \u8fde\u7eed\u59ff\u6001\u6837\u6761\uff1a\u7403\u5750\u6807 B \u6837\u6761 + 7 \u9636 B\u00e9zier \u91cd\u53c2\u6570\u5316</li> <li>A-C \u914d\u7f6e\u9006\u8fd0\u52a8\u5b66\uff1a\u5de5\u4ef6\u5750\u6807\u5230\u673a\u5e8a\u5750\u6807\u7684\u53d8\u6362</li> </ul>"},{"location":"#_2","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code>from cnc_five_axis_interpolation import FiveAxisPath\nfrom cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path\n\n# \u52a0\u8f7d\u6570\u636e\npositions, orientations, _ = ijms2021_fan_shaped_path()\n\n# \u62df\u5408\u8f68\u8ff9\npath = FiveAxisPath(positions, orientations).fit()\n\n# \u5728\u4efb\u610f\u5f27\u957f\u5904\u8bc4\u4f30\npos, ori = path.evaluate(50.0)  # l = 50mm\n\n# \u83b7\u53d6\u673a\u5e8a\u5750\u6807\nXYZ, A, C = path.evaluate_machine_coords(50.0, L_ac_z=70.0, L_Tya_z=150.0)\n</code></pre>"},{"location":"#_3","title":"\u6587\u6863\u7ed3\u6784","text":""},{"location":"#notebooks","title":"\u6559\u7a0b (Notebooks)","text":"<p>\u5b9e\u7528\u5bfc\u5411\uff0c\u5feb\u901f\u4e0a\u624b + \u539f\u7406\u6982\u8ff0\uff1a</p> Notebook \u5185\u5bb9 01_position_spline \u4f4d\u7f6e\u6837\u6761\u4f7f\u7528\u4e0e\u539f\u7406 02_orientation_spline \u59ff\u6001\u6837\u6761\u4f7f\u7528\u4e0e\u539f\u7406 03_inverse_kinematics \u9006\u8fd0\u52a8\u5b66\u4f7f\u7528\u4e0e\u539f\u7406 04_end_to_end_example \u5b8c\u6574\u4e94\u8f74\u8f68\u8ff9\u751f\u6210\u6d41\u7a0b"},{"location":"#theory","title":"\u6570\u5b66\u63a8\u5bfc (Theory)","text":"<p>\u7406\u8bba\u5bfc\u5411\uff0c\u8be6\u7ec6\u516c\u5f0f\u63a8\u5bfc\uff1a</p> \u6587\u6863 \u8986\u76d6\u516c\u5f0f bspline_interpolation Eq.1-7 arc_length_parameterization Eq.8-10 feed_correction_polynomial Eq.11-23 spherical_orientation Eq.25-31 bezier_reparameterization Eq.32-41 ac_kinematics Eq.42"},{"location":"#c3","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 C\u00b3 \u8fde\u7eed\u6027\uff1f","text":"\u8fde\u7eed\u6027 \u7269\u7406\u610f\u4e49 \u5f71\u54cd C\u2070 \u4f4d\u7f6e\u8fde\u7eed \u8f68\u8ff9\u65e0\u8df3\u53d8 C\u00b9 \u901f\u5ea6\u8fde\u7eed \u65e0\u901f\u5ea6\u7a81\u53d8 C\u00b2 \u52a0\u901f\u5ea6\u8fde\u7eed \u65e0\u52a0\u901f\u5ea6\u7a81\u53d8 C\u00b3 Jerk \u8fde\u7eed \u51cf\u5c11\u673a\u5e8a\u632f\u52a8\uff0c\u63d0\u9ad8\u52a0\u5de5\u8d28\u91cf"},{"location":"#_4","title":"\u7b97\u6cd5\u6d41\u7a0b","text":"<pre><code>\u79bb\u6563\u6570\u636e\u70b9 (P, O)\n       \u2193\n\u4e94\u6b21 B \u6837\u6761\u62df\u5408 (Eq.1-7)\n       \u2193\n\u5f27\u957f\u8ba1\u7b97 (Eq.8-10)\n       \u2193\n\u8fdb\u7ed9\u6821\u6b63/B\u00e9zier \u91cd\u53c2\u6570\u5316 (Eq.11-41)\n       \u2193\nC\u00b3 \u8fde\u7eed\u5f27\u957f\u53c2\u6570\u5316\u8f68\u8ff9\n       \u2193\n\u9006\u8fd0\u52a8\u5b66 (Eq.42)\n       \u2193\n\u673a\u5e8a\u4e94\u8f74\u8fd0\u52a8 (X, Y, Z, A, C)\n</code></pre>"},{"location":"#_5","title":"\u672c\u5730\u6784\u5efa\u6587\u6863","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\npip install mkdocs mkdocs-material mkdocs-jupyter\n\n# \u672c\u5730\u9884\u89c8\ncd cnc_five_axis_interpolation/docs\nmkdocs serve\n\n# \u6784\u5efa\u9759\u6001\u7ad9\u70b9\nmkdocs build\n</code></pre>"},{"location":"#_6","title":"\u53c2\u8003\u6587\u732e","text":"<p>Yuen, A., Zhang, K., &amp; Altintas, Y. (2013). Smooth trajectory generation for five-axis machine tools. International Journal of Machine Tools and Manufacture, 71, 11-19.</p>"},{"location":"notebooks/01_position_spline/","title":"\u4f4d\u7f6e\u6837\u6761","text":"In\u00a0[1]: Copied! <pre>import os\nimport sys\n\nsys.path.insert(0, os.path.abspath(\"../../..\"))\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.mplot3d import Axes3D\n\nfrom cnc_five_axis_interpolation.core.position_spline import PositionSpline\nfrom cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path\n\n%config InlineBackend.figure_format='retina'\n</pre> import os import sys  sys.path.insert(0, os.path.abspath(\"../../..\"))  import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D  from cnc_five_axis_interpolation.core.position_spline import PositionSpline from cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path  %config InlineBackend.figure_format='retina' In\u00a0[2]: Copied! <pre># \u52a0\u8f7d\u793a\u4f8b\u6570\u636e\npositions, orientations, _ = ijms2021_fan_shaped_path()\nprint(f\"\u6570\u636e\u70b9\u6570: {len(positions)}\")\nprint(f\"\u4f4d\u7f6e\u8303\u56f4: X=[{positions[:, 0].min():.1f}, {positions[:, 0].max():.1f}]\")\n</pre> # \u52a0\u8f7d\u793a\u4f8b\u6570\u636e positions, orientations, _ = ijms2021_fan_shaped_path() print(f\"\u6570\u636e\u70b9\u6570: {len(positions)}\") print(f\"\u4f4d\u7f6e\u8303\u56f4: X=[{positions[:, 0].min():.1f}, {positions[:, 0].max():.1f}]\") <pre>\u6570\u636e\u70b9\u6570: 25\n\u4f4d\u7f6e\u8303\u56f4: X=[-49.4, 117.9]\n</pre> In\u00a0[3]: Copied! <pre># \u62df\u5408\u4f4d\u7f6e\u6837\u6761\nspline = PositionSpline(positions, mse_tolerance=1e-6)\nspline.fit()\n\nprint(f\"\u8f68\u8ff9\u603b\u5f27\u957f: {spline.length:.2f} mm\")\nprint(f\"\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u6bb5\u6570: {len(spline.feed_corrections)}\")\n</pre> # \u62df\u5408\u4f4d\u7f6e\u6837\u6761 spline = PositionSpline(positions, mse_tolerance=1e-6) spline.fit()  print(f\"\u8f68\u8ff9\u603b\u5f27\u957f: {spline.length:.2f} mm\") print(f\"\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u6bb5\u6570: {len(spline.feed_corrections)}\") <pre>\u8f68\u8ff9\u603b\u5f27\u957f: 344.79 mm\n\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u6bb5\u6570: 8\n</pre> In\u00a0[4]: Copied! <pre># \u5728\u4efb\u610f\u5f27\u957f\u5904\u8bc4\u4f30\u4f4d\u7f6e\nl = 50.0  # \u5f27\u957f 50mm\npos = spline.evaluate(l)\nprint(f\"l={l}mm \u5904\u7684\u4f4d\u7f6e: ({pos[0]:.3f}, {pos[1]:.3f}, {pos[2]:.3f})\")\n\n# \u6279\u91cf\u8bc4\u4f30\nl_values = np.linspace(0, spline.length, 100)\npositions_interp = spline.evaluate_batch(l_values)\nprint(f\"\u63d2\u503c\u70b9\u6570: {len(positions_interp)}\")\n</pre> # \u5728\u4efb\u610f\u5f27\u957f\u5904\u8bc4\u4f30\u4f4d\u7f6e l = 50.0  # \u5f27\u957f 50mm pos = spline.evaluate(l) print(f\"l={l}mm \u5904\u7684\u4f4d\u7f6e: ({pos[0]:.3f}, {pos[1]:.3f}, {pos[2]:.3f})\")  # \u6279\u91cf\u8bc4\u4f30 l_values = np.linspace(0, spline.length, 100) positions_interp = spline.evaluate_batch(l_values) print(f\"\u63d2\u503c\u70b9\u6570: {len(positions_interp)}\") <pre>l=50.0mm \u5904\u7684\u4f4d\u7f6e: (113.241, -40.858, 1.475)\n\u63d2\u503c\u70b9\u6570: 100\n</pre> In\u00a0[5]: Copied! <pre># \u9a8c\u8bc1\u63d2\u503c\u7cbe\u5ea6\uff1a\u6837\u6761\u5e94\u7a7f\u8fc7\u6240\u6709\u6570\u636e\u70b9\nerrors = []\nfor i, u in enumerate(spline.u_bar):\n    interp_pos = spline.spline(u)\n    error = np.linalg.norm(interp_pos - positions[i])\n    errors.append(error)\n\nprint(f\"\u63d2\u503c\u8bef\u5dee: max={max(errors):.2e}, mean={np.mean(errors):.2e}\")\n</pre> # \u9a8c\u8bc1\u63d2\u503c\u7cbe\u5ea6\uff1a\u6837\u6761\u5e94\u7a7f\u8fc7\u6240\u6709\u6570\u636e\u70b9 errors = [] for i, u in enumerate(spline.u_bar):     interp_pos = spline.spline(u)     error = np.linalg.norm(interp_pos - positions[i])     errors.append(error)  print(f\"\u63d2\u503c\u8bef\u5dee: max={max(errors):.2e}, mean={np.mean(errors):.2e}\") <pre>\u63d2\u503c\u8bef\u5dee: max=2.86e-14, mean=7.53e-15\n</pre> In\u00a0[6]: Copied! <pre># 3D \u8f68\u8ff9\u53ef\u89c6\u5316\nfig = plt.figure(figsize=(12, 5))\n\n# \u5de6\u56fe\uff1a3D \u8f68\u8ff9\nax1 = fig.add_subplot(121, projection=\"3d\")\nax1.scatter(\n    positions[:, 0],\n    positions[:, 1],\n    positions[:, 2],\n    c=\"red\",\n    s=20,\n    label=\"Data Points\",\n    zorder=5,\n)\nax1.plot(\n    positions_interp[:, 0],\n    positions_interp[:, 1],\n    positions_interp[:, 2],\n    \"b-\",\n    linewidth=1.5,\n    label=\"Interpolated Curve\",\n)\nax1.set_xlabel(\"X (mm)\")\nax1.set_ylabel(\"Y (mm)\")\nax1.set_zlabel(\"Z (mm)\")\nax1.legend()\nax1.set_title(\"Tool Tip Trajectory\")\n\n# \u53f3\u56fe\uff1au(l) \u5173\u7cfb\nax2 = fig.add_subplot(122)\nu_values = spline.get_u_from_length(l_values)\nax2.plot(l_values, u_values, \"b-\", linewidth=1.5, label=\"u(l)\")\nax2.plot(l_values, l_values / spline.length, \"r--\", linewidth=1, label=\"l/S (Linear)\")\nax2.set_xlabel(\"Arc Length l (mm)\")\nax2.set_ylabel(\"Parameter u\")\nax2.legend()\nax2.set_title(\"Arc Length Parameterization Mapping\")\nax2.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n</pre> # 3D \u8f68\u8ff9\u53ef\u89c6\u5316 fig = plt.figure(figsize=(12, 5))  # \u5de6\u56fe\uff1a3D \u8f68\u8ff9 ax1 = fig.add_subplot(121, projection=\"3d\") ax1.scatter(     positions[:, 0],     positions[:, 1],     positions[:, 2],     c=\"red\",     s=20,     label=\"Data Points\",     zorder=5, ) ax1.plot(     positions_interp[:, 0],     positions_interp[:, 1],     positions_interp[:, 2],     \"b-\",     linewidth=1.5,     label=\"Interpolated Curve\", ) ax1.set_xlabel(\"X (mm)\") ax1.set_ylabel(\"Y (mm)\") ax1.set_zlabel(\"Z (mm)\") ax1.legend() ax1.set_title(\"Tool Tip Trajectory\")  # \u53f3\u56fe\uff1au(l) \u5173\u7cfb ax2 = fig.add_subplot(122) u_values = spline.get_u_from_length(l_values) ax2.plot(l_values, u_values, \"b-\", linewidth=1.5, label=\"u(l)\") ax2.plot(l_values, l_values / spline.length, \"r--\", linewidth=1, label=\"l/S (Linear)\") ax2.set_xlabel(\"Arc Length l (mm)\") ax2.set_ylabel(\"Parameter u\") ax2.legend() ax2.set_title(\"Arc Length Parameterization Mapping\") ax2.grid(True, alpha=0.3)  plt.tight_layout() plt.show() In\u00a0[7]: Copied! <pre># C\u00b3 \u8fde\u7eed\u6027\u9a8c\u8bc1\uff1a\u6570\u503c\u5fae\u5206\u68c0\u67e5 jerk\nh = 0.01  # \u5f27\u957f\u6b65\u957f\nl_test = np.arange(h, spline.length - h, h)\n\n# \u4f4d\u7f6e\npos = spline.evaluate_batch(l_test)\n\n# \u901f\u5ea6 (d\u4f4d\u7f6e/dl)\npos_plus = spline.evaluate_batch(l_test + h)\npos_minus = spline.evaluate_batch(l_test - h)\nvelocity = (pos_plus - pos_minus) / (2 * h)\nspeed = np.linalg.norm(velocity, axis=1)\n\n# \u52a0\u901f\u5ea6\nvel_plus = (spline.evaluate_batch(l_test + h) - pos) / h\nvel_minus = (pos - spline.evaluate_batch(l_test - h)) / h\naccel = (vel_plus - vel_minus) / h\naccel_mag = np.linalg.norm(accel, axis=1)\n\n# Jerk (d\u00b3\u4f4d\u7f6e/dl\u00b3)\nh2 = 2 * h\npos_pp = spline.evaluate_batch(l_test + h2)\npos_p = spline.evaluate_batch(l_test + h)\npos_m = spline.evaluate_batch(l_test - h)\npos_mm = spline.evaluate_batch(l_test - h2)\njerk = (pos_pp - 2 * pos_p + 2 * pos_m - pos_mm) / (2 * h**3)\njerk_mag = np.linalg.norm(jerk, axis=1)\n\n# \u7ed8\u56fe\nfig, axes = plt.subplots(3, 1, figsize=(10, 8), sharex=True)\n\naxes[0].plot(l_test, speed, \"b-\")\naxes[0].set_ylabel(\"Speed |dP/dl|\")\naxes[0].set_title(\"Speed, Acceleration, Jerk Continuity Verification\")\naxes[0].grid(True, alpha=0.3)\n\naxes[1].plot(l_test, accel_mag, \"g-\")\naxes[1].set_ylabel(\"Acceleration |d\u00b2P/dl\u00b2|\")\naxes[1].grid(True, alpha=0.3)\n\naxes[2].plot(l_test, jerk_mag, \"r-\")\naxes[2].set_ylabel(\"Jerk |d\u00b3P/dl\u00b3|\")\naxes[2].set_xlabel(\"Arc Length l (mm)\")\naxes[2].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n\nprint(f\"Jerk \u7edf\u8ba1: max={jerk_mag.max():.4f}, mean={jerk_mag.mean():.4f}\")\nprint(\"\u2714 Jerk \u66f2\u7ebf\u8fde\u7eed\u65e0\u7a81\u53d8\uff0c\u8bc1\u660e C\u00b3 \u8fde\u7eed\u6027\")\n</pre> # C\u00b3 \u8fde\u7eed\u6027\u9a8c\u8bc1\uff1a\u6570\u503c\u5fae\u5206\u68c0\u67e5 jerk h = 0.01  # \u5f27\u957f\u6b65\u957f l_test = np.arange(h, spline.length - h, h)  # \u4f4d\u7f6e pos = spline.evaluate_batch(l_test)  # \u901f\u5ea6 (d\u4f4d\u7f6e/dl) pos_plus = spline.evaluate_batch(l_test + h) pos_minus = spline.evaluate_batch(l_test - h) velocity = (pos_plus - pos_minus) / (2 * h) speed = np.linalg.norm(velocity, axis=1)  # \u52a0\u901f\u5ea6 vel_plus = (spline.evaluate_batch(l_test + h) - pos) / h vel_minus = (pos - spline.evaluate_batch(l_test - h)) / h accel = (vel_plus - vel_minus) / h accel_mag = np.linalg.norm(accel, axis=1)  # Jerk (d\u00b3\u4f4d\u7f6e/dl\u00b3) h2 = 2 * h pos_pp = spline.evaluate_batch(l_test + h2) pos_p = spline.evaluate_batch(l_test + h) pos_m = spline.evaluate_batch(l_test - h) pos_mm = spline.evaluate_batch(l_test - h2) jerk = (pos_pp - 2 * pos_p + 2 * pos_m - pos_mm) / (2 * h**3) jerk_mag = np.linalg.norm(jerk, axis=1)  # \u7ed8\u56fe fig, axes = plt.subplots(3, 1, figsize=(10, 8), sharex=True)  axes[0].plot(l_test, speed, \"b-\") axes[0].set_ylabel(\"Speed |dP/dl|\") axes[0].set_title(\"Speed, Acceleration, Jerk Continuity Verification\") axes[0].grid(True, alpha=0.3)  axes[1].plot(l_test, accel_mag, \"g-\") axes[1].set_ylabel(\"Acceleration |d\u00b2P/dl\u00b2|\") axes[1].grid(True, alpha=0.3)  axes[2].plot(l_test, jerk_mag, \"r-\") axes[2].set_ylabel(\"Jerk |d\u00b3P/dl\u00b3|\") axes[2].set_xlabel(\"Arc Length l (mm)\") axes[2].grid(True, alpha=0.3)  plt.tight_layout() plt.show()  print(f\"Jerk \u7edf\u8ba1: max={jerk_mag.max():.4f}, mean={jerk_mag.mean():.4f}\") print(\"\u2714 Jerk \u66f2\u7ebf\u8fde\u7eed\u65e0\u7a81\u53d8\uff0c\u8bc1\u660e C\u00b3 \u8fde\u7eed\u6027\") <pre>Jerk \u7edf\u8ba1: max=5000.0027, mean=0.2634\n\u2714 Jerk \u66f2\u7ebf\u8fde\u7eed\u65e0\u7a81\u53d8\uff0c\u8bc1\u660e C\u00b3 \u8fde\u7eed\u6027\n</pre>"},{"location":"notebooks/01_position_spline/#position-spline-c3","title":"Position Spline: C\u00b3 \u8fde\u7eed\u4f4d\u7f6e\u6837\u6761\u00b6","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 <code>PositionSpline</code> \u7c7b\u5c06\u79bb\u6563\u5200\u5c16\u4f4d\u7f6e\u62df\u5408\u4e3a C\u00b3 \u8fde\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u6837\u6761\u66f2\u7ebf\u3002</p>"},{"location":"notebooks/01_position_spline/#1-c3","title":"1. \u4e3a\u4ec0\u4e48\u9700\u8981 C\u00b3 \u8fde\u7eed\u6027\uff1f\u00b6","text":"<p>\u5728\u4e94\u8f74 CNC \u52a0\u5de5\u4e2d\uff0c\u5200\u5177\u8f68\u8ff9\u7684\u5e73\u6ed1\u6027\u76f4\u63a5\u5f71\u54cd\u52a0\u5de5\u8d28\u91cf\uff1a</p> \u8fde\u7eed\u6027\u7b49\u7ea7 \u7269\u7406\u610f\u4e49 \u5f71\u54cd C\u2070 \u4f4d\u7f6e\u8fde\u7eed \u8f68\u8ff9\u65e0\u8df3\u53d8 C\u00b9 \u901f\u5ea6\u8fde\u7eed \u65e0\u901f\u5ea6\u7a81\u53d8 C\u00b2 \u52a0\u901f\u5ea6\u8fde\u7eed \u65e0\u52a0\u901f\u5ea6\u7a81\u53d8 C\u00b3 Jerk \u8fde\u7eed \u65e0\u52a0\u901f\u5ea6\u5bfc\u6570\u7a81\u53d8\uff0c\u51cf\u5c11\u673a\u5e8a\u632f\u52a8 <p>Yuen et al. (2013) \u7684\u7b97\u6cd5\u901a\u8fc7\u4e94\u6b21 B \u6837\u6761 + 9\u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u5b9e\u73b0 C\u00b3 \u8fde\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u3002</p>"},{"location":"notebooks/01_position_spline/#2","title":"2. \u5feb\u901f\u4e0a\u624b\u00b6","text":""},{"location":"notebooks/01_position_spline/#3","title":"3. \u7b97\u6cd5\u539f\u7406\u6982\u8ff0\u00b6","text":"<p><code>PositionSpline</code> \u7684\u5b9e\u73b0\u5206\u4e3a\u4e09\u4e2a\u6b65\u9aa4\uff1a</p>"},{"location":"notebooks/01_position_spline/#31-b-eq1-7","title":"3.1 \u4e94\u6b21 B \u6837\u6761\u62df\u5408 (Eq.1-7)\u00b6","text":"<p>\u7ed9\u5b9a $N$ \u4e2a\u6570\u636e\u70b9 $\\{\\mathbf{P}_i\\}_{i=0}^{N-1}$\uff0c\u6784\u9020\u4e94\u6b21 B \u6837\u6761\u4f7f\u5176\u7a7f\u8fc7\u6240\u6709\u70b9\uff1a</p> <p>$$\\mathbf{P}(u) = \\sum_{j=0}^{N-1} N_{j,5}(u) \\mathbf{Q}_j$$</p> <p>\u5176\u4e2d $\\mathbf{Q}_j$ \u662f\u63a7\u5236\u70b9\uff0c$N_{j,5}(u)$ \u662f\u4e94\u6b21 B \u6837\u6761\u57fa\u51fd\u6570\u3002</p> <p>\u5411\u5fc3\u53c2\u6570\u5316 (Eq.4-7)\uff1a\u4f7f\u7528\u76f8\u90bb\u70b9\u8ddd\u79bb\u7684\u5e73\u65b9\u6839\u5206\u914d\u53c2\u6570\uff0c\u6bd4\u5f26\u957f\u53c2\u6570\u5316\u66f4\u80fd\u907f\u514d\u5c16\u70b9\u95ee\u9898\u3002</p> <p>\u8be6\u7ec6\u6570\u5b66\u63a8\u5bfc\u89c1 B\u6837\u6761\u63d2\u503c\u7406\u8bba</p>"},{"location":"notebooks/01_position_spline/#32-eq8-10","title":"3.2 \u5f27\u957f\u8ba1\u7b97 (Eq.8-10)\u00b6","text":"<p>\u5f27\u957f\u901a\u8fc7\u5bf9\u6837\u6761\u5bfc\u6570\u6a21\u957f\u79ef\u5206\u5f97\u5230\uff1a</p> <p>$$s(u) = \\int_0^u \\|\\mathbf{P}'(\\tau)\\| d\\tau$$</p> <p>\u4f7f\u7528\u81ea\u9002\u5e94 Simpson \u79ef\u5206\u786e\u4fdd\u7cbe\u5ea6\uff0c\u540c\u65f6\u6784\u5efa\u5f27\u957f\u8868\u7528\u4e8e\u540e\u7eed\u53c2\u6570\u6620\u5c04\u3002</p> <p>\u8be6\u7ec6\u6570\u5b66\u63a8\u5bfc\u89c1 \u5f27\u957f\u53c2\u6570\u5316\u7406\u8bba</p>"},{"location":"notebooks/01_position_spline/#33-9-eq11-23","title":"3.3 9\u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f (Eq.11-23)\u00b6","text":"<p>\u4e3a\u5b9e\u73b0\u5f27\u957f\u53c2\u6570\u5316\uff0c\u9700\u8981\u6784\u5efa\u6620\u5c04 $u(l)$\uff0c\u5c06\u5f27\u957f $l$ \u6620\u5c04\u5230\u6837\u6761\u53c2\u6570 $u$\u3002</p> <p>9\u9636\u591a\u9879\u5f0f\u5f62\u5f0f (Eq.11-13)\uff1a $$u(\\sigma) = \\sum_{i=0}^{9} a_i \\sigma^i, \\quad \\sigma = l/S$$</p> <p>C\u00b3 \u8fb9\u754c\u6761\u4ef6 (Eq.14-18)\uff1a\u901a\u8fc7\u7ea6\u675f\u591a\u9879\u5f0f\u5728\u7aef\u70b9\u7684\u5bfc\u6570\uff0c\u4fdd\u8bc1\u6bb5\u95f4 C\u00b3 \u8fde\u7eed\u6027\u3002</p> <p>\u8be6\u7ec6\u6570\u5b66\u63a8\u5bfc\u89c1 \u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u7406\u8bba</p>"},{"location":"notebooks/01_position_spline/#4","title":"4. \u53ef\u89c6\u5316\u00b6","text":""},{"location":"notebooks/01_position_spline/#5-api","title":"5. API \u53c2\u8003\u00b6","text":""},{"location":"notebooks/01_position_spline/#positionspline","title":"<code>PositionSpline</code> \u7c7b\u00b6","text":"<pre>class PositionSpline:\n    def __init__(self, points: np.ndarray, mse_tolerance: float = 1e-6):\n        \"\"\"\n        Args:\n            points: (N, 3) \u5200\u5c16\u4f4d\u7f6e\u70b9\n            mse_tolerance: \u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u7684 MSE \u5bb9\u5dee\n        \"\"\"\n    \n    def fit(self) -&gt; 'PositionSpline':\n        \"\"\"\u62df\u5408\u6837\u6761\uff0c\u8fd4\u56de self \u652f\u6301\u94fe\u5f0f\u8c03\u7528\"\"\"\n    \n    def evaluate(self, l: float) -&gt; np.ndarray:\n        \"\"\"\u5728\u5f27\u957f l \u5904\u8bc4\u4f30\u4f4d\u7f6e\uff0c\u8fd4\u56de (3,) \u6570\u7ec4\"\"\"\n    \n    def evaluate_batch(self, l_values: np.ndarray) -&gt; np.ndarray:\n        \"\"\"\u6279\u91cf\u8bc4\u4f30\uff0c\u8fd4\u56de (M, 3) \u6570\u7ec4\"\"\"\n    \n    @property\n    def length(self) -&gt; float:\n        \"\"\"\u8f68\u8ff9\u603b\u5f27\u957f\"\"\"\n</pre>"},{"location":"notebooks/01_position_spline/","title":"\u5c5e\u6027\u00b6","text":"\u5c5e\u6027 \u7c7b\u578b \u8bf4\u660e <code>spline</code> <code>BSpline</code> scipy \u4e94\u6b21 B \u6837\u6761\u5bf9\u8c61 <code>u_bar</code> <code>ndarray</code> \u53c2\u6570\u5316\u503c <code>length</code> <code>float</code> \u603b\u5f27\u957f <code>feed_corrections</code> <code>list</code> \u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u5217\u8868"},{"location":"notebooks/01_position_spline/","title":"\u603b\u7ed3\u00b6","text":"<p><code>PositionSpline</code> \u901a\u8fc7\u4e94\u6b21 B \u6837\u6761\u62df\u5408\u548c 9 \u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\uff0c\u5b9e\u73b0\u4e86 C\u00b3 \u8fde\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u4f4d\u7f6e\u6837\u6761\u3002\u8fd9\u786e\u4fdd\u4e86\u5200\u5177\u8f68\u8ff9\u7684 jerk \u8fde\u7eed\u6027\uff0c\u51cf\u5c11\u673a\u5e8a\u632f\u52a8\uff0c\u63d0\u9ad8\u52a0\u5de5\u8d28\u91cf\u3002</p>"},{"location":"notebooks/02_orientation_spline/","title":"\u59ff\u6001\u6837\u6761","text":"In\u00a0[1]: Copied! <pre>import os\nimport sys\n\nsys.path.insert(0, os.path.abspath(\"../../..\"))\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.mplot3d import Axes3D\nimport plotly.graph_objects as go\n\nfrom cnc_five_axis_interpolation.core.orientation_spline import OrientationSpline\nfrom cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path\n\n%config InlineBackend.figure_format='retina'\n</pre> import os import sys  sys.path.insert(0, os.path.abspath(\"../../..\"))  import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D import plotly.graph_objects as go  from cnc_five_axis_interpolation.core.orientation_spline import OrientationSpline from cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path  %config InlineBackend.figure_format='retina' In\u00a0[2]: Copied! <pre># \u52a0\u8f7d\u793a\u4f8b\u6570\u636e\npositions, orientations, _ = ijms2021_fan_shaped_path()\n\n# \u8ba1\u7b97\u5f27\u957f\ndists = np.linalg.norm(np.diff(positions, axis=0), axis=1)\narc_lengths = np.concatenate([[0], np.cumsum(dists)])\n\nprint(f\"\u59ff\u6001\u70b9\u6570: {len(orientations)}\")\nprint(f\"\u603b\u5f27\u957f: {arc_lengths[-1]:.2f} mm\")\n</pre> # \u52a0\u8f7d\u793a\u4f8b\u6570\u636e positions, orientations, _ = ijms2021_fan_shaped_path()  # \u8ba1\u7b97\u5f27\u957f dists = np.linalg.norm(np.diff(positions, axis=0), axis=1) arc_lengths = np.concatenate([[0], np.cumsum(dists)])  print(f\"\u59ff\u6001\u70b9\u6570: {len(orientations)}\") print(f\"\u603b\u5f27\u957f: {arc_lengths[-1]:.2f} mm\") <pre>\u59ff\u6001\u70b9\u6570: 25\n\u603b\u5f27\u957f: 342.91 mm\n</pre> In\u00a0[3]: Copied! <pre># \u62df\u5408\u59ff\u6001\u6837\u6761\nspline = OrientationSpline(orientations, arc_lengths)\nspline.fit()\n\nprint(f\"\u59ff\u6001\u6837\u6761\u62df\u5408\u5b8c\u6210\")\n</pre> # \u62df\u5408\u59ff\u6001\u6837\u6761 spline = OrientationSpline(orientations, arc_lengths) spline.fit()  print(f\"\u59ff\u6001\u6837\u6761\u62df\u5408\u5b8c\u6210\") <pre>\u59ff\u6001\u6837\u6761\u62df\u5408\u5b8c\u6210\n</pre> In\u00a0[4]: Copied! <pre># \u5728\u4efb\u610f\u5f27\u957f\u5904\u8bc4\u4f30\u59ff\u6001\nl = 50.0\nori = spline.evaluate(l)\nprint(f\"l={l}mm \u5904\u7684\u59ff\u6001: ({ori[0]:.4f}, {ori[1]:.4f}, {ori[2]:.4f})\")\nprint(f\"\u59ff\u6001\u6a21\u957f: {np.linalg.norm(ori):.10f} (\u5e94\u4e3a 1.0)\")\n\n# \u6279\u91cf\u8bc4\u4f30\nl_values = np.linspace(0, arc_lengths[-1], 100)\norientations_interp = spline.evaluate_batch(l_values)\nprint(f\"\u63d2\u503c\u70b9\u6570: {len(orientations_interp)}\")\n</pre> # \u5728\u4efb\u610f\u5f27\u957f\u5904\u8bc4\u4f30\u59ff\u6001 l = 50.0 ori = spline.evaluate(l) print(f\"l={l}mm \u5904\u7684\u59ff\u6001: ({ori[0]:.4f}, {ori[1]:.4f}, {ori[2]:.4f})\") print(f\"\u59ff\u6001\u6a21\u957f: {np.linalg.norm(ori):.10f} (\u5e94\u4e3a 1.0)\")  # \u6279\u91cf\u8bc4\u4f30 l_values = np.linspace(0, arc_lengths[-1], 100) orientations_interp = spline.evaluate_batch(l_values) print(f\"\u63d2\u503c\u70b9\u6570: {len(orientations_interp)}\") <pre>l=50.0mm \u5904\u7684\u59ff\u6001: (0.1719, 0.6382, 0.7504)\n\u59ff\u6001\u6a21\u957f: 1.0000000000 (\u5e94\u4e3a 1.0)\n\u63d2\u503c\u70b9\u6570: 100\n</pre> In\u00a0[5]: Copied! <pre># \u9a8c\u8bc1\u63d2\u503c\u7cbe\u5ea6\nfrom cnc_five_axis_interpolation.core.orientation_spline import (\n    evaluate_orientation_from_spherical,\n)\n\nerrors = []\nfor i, w in enumerate(spline.w_bar):\n    interp_ori = evaluate_orientation_from_spherical(spline.spline, w)\n    interp_ori = interp_ori / np.linalg.norm(interp_ori)\n    error = np.linalg.norm(interp_ori - orientations[i])\n    errors.append(error)\n\nprint(f\"\u63d2\u503c\u8bef\u5dee: max={max(errors):.2e}, mean={np.mean(errors):.2e}\")\n</pre> # \u9a8c\u8bc1\u63d2\u503c\u7cbe\u5ea6 from cnc_five_axis_interpolation.core.orientation_spline import (     evaluate_orientation_from_spherical, )  errors = [] for i, w in enumerate(spline.w_bar):     interp_ori = evaluate_orientation_from_spherical(spline.spline, w)     interp_ori = interp_ori / np.linalg.norm(interp_ori)     error = np.linalg.norm(interp_ori - orientations[i])     errors.append(error)  print(f\"\u63d2\u503c\u8bef\u5dee: max={max(errors):.2e}, mean={np.mean(errors):.2e}\") <pre>\u63d2\u503c\u8bef\u5dee: max=5.98e-16, mean=2.00e-16\n</pre> In\u00a0[6]: Copied! <pre># \u7403\u5750\u6807\u8f68\u8ff9\u53ef\u89c6\u5316\nfrom cnc_five_axis_interpolation.utils.geometry import batch_cartesian_to_spherical\n\n# \u539f\u59cb\u6570\u636e\u70b9\u7684\u7403\u5750\u6807\ntheta_data, phi_data = batch_cartesian_to_spherical(orientations)\n\n# \u63d2\u503c\u70b9\u7684\u7403\u5750\u6807\ntheta_interp, phi_interp = batch_cartesian_to_spherical(orientations_interp)\n\nfig, axes = plt.subplots(1, 2, figsize=(12, 5))\n\n# \u5de6\u56fe\uff1a(\u03b8, \u03c6) \u5e73\u9762\naxes[0].scatter(\n    np.degrees(theta_data),\n    np.degrees(phi_data),\n    c=\"red\",\n    s=30,\n    label=\"Data Points\",\n    zorder=5,\n)\naxes[0].plot(\n    np.degrees(theta_interp),\n    np.degrees(phi_interp),\n    \"b-\",\n    linewidth=1.5,\n    label=\"Interpolated Curve\",\n)\naxes[0].set_xlabel(r\"$\\theta$ (deg)\")\naxes[0].set_ylabel(r\"$\\phi$ (deg)\")\naxes[0].legend()\naxes[0].set_title(r\"$\\theta$-$\\phi$ Plane Trajectory\")\naxes[0].grid(True, alpha=0.3)\n\n# \u53f3\u56fe\uff1aw(l) \u5173\u7cfb\nw_values = spline.reparameterization.evaluate_batch(l_values)\naxes[1].plot(l_values, w_values, \"b-\", linewidth=1.5, label=\"w(l)\")\naxes[1].plot(\n    l_values, l_values / arc_lengths[-1], \"r--\", linewidth=1, label=\"l/L (Linear)\"\n)\naxes[1].set_xlabel(\"Arc Length l (mm)\")\naxes[1].set_ylabel(\"Parameter w\")\naxes[1].legend()\naxes[1].set_title(\"B\u00e9zier Reparameterization Mapping\")\naxes[1].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n</pre> # \u7403\u5750\u6807\u8f68\u8ff9\u53ef\u89c6\u5316 from cnc_five_axis_interpolation.utils.geometry import batch_cartesian_to_spherical  # \u539f\u59cb\u6570\u636e\u70b9\u7684\u7403\u5750\u6807 theta_data, phi_data = batch_cartesian_to_spherical(orientations)  # \u63d2\u503c\u70b9\u7684\u7403\u5750\u6807 theta_interp, phi_interp = batch_cartesian_to_spherical(orientations_interp)  fig, axes = plt.subplots(1, 2, figsize=(12, 5))  # \u5de6\u56fe\uff1a(\u03b8, \u03c6) \u5e73\u9762 axes[0].scatter(     np.degrees(theta_data),     np.degrees(phi_data),     c=\"red\",     s=30,     label=\"Data Points\",     zorder=5, ) axes[0].plot(     np.degrees(theta_interp),     np.degrees(phi_interp),     \"b-\",     linewidth=1.5,     label=\"Interpolated Curve\", ) axes[0].set_xlabel(r\"$\\theta$ (deg)\") axes[0].set_ylabel(r\"$\\phi$ (deg)\") axes[0].legend() axes[0].set_title(r\"$\\theta$-$\\phi$ Plane Trajectory\") axes[0].grid(True, alpha=0.3)  # \u53f3\u56fe\uff1aw(l) \u5173\u7cfb w_values = spline.reparameterization.evaluate_batch(l_values) axes[1].plot(l_values, w_values, \"b-\", linewidth=1.5, label=\"w(l)\") axes[1].plot(     l_values, l_values / arc_lengths[-1], \"r--\", linewidth=1, label=\"l/L (Linear)\" ) axes[1].set_xlabel(\"Arc Length l (mm)\") axes[1].set_ylabel(\"Parameter w\") axes[1].legend() axes[1].set_title(\"B\u00e9zier Reparameterization Mapping\") axes[1].grid(True, alpha=0.3)  plt.tight_layout() plt.show() In\u00a0[7]: Copied! <pre># Plotly \u5728 MkDocs/nbconvert \u4e0b\u9ed8\u8ba4\u8f93\u51fa\u7684\u662f vnd.plotly JSON\uff0c\u53ef\u80fd\u5bfc\u81f4\u65e0\u6cd5\u5d4c\u5165\u9875\u9762\u7684 warning\u3002\n# \u89e3\u51b3\uff1a\u663e\u5f0f\u8f93\u51fa\u4e3a HTML\uff08text/html\uff09\uff0cMkDocs-jupyter \u53ef\u4ee5\u76f4\u63a5\u6e32\u67d3\u3002\n\nfrom IPython.display import HTML\n\n\ndef add_unit_sphere(fig, n_lon=24, n_lat=12, line_rgba=\"black\"):\n    theta = np.linspace(0, np.pi, 240)\n    phi = np.linspace(0, 2 * np.pi, 240)\n    for k in range(n_lon):\n        p = 2 * np.pi * k / n_lon\n        fig.add_trace(\n            go.Scatter3d(\n                x=np.cos(p) * np.sin(theta),\n                y=np.sin(p) * np.sin(theta),\n                z=np.cos(theta),\n                mode=\"lines\",\n                line=dict(color=line_rgba, width=1),\n                hoverinfo=\"skip\",\n                showlegend=False,\n            )\n        )\n    for k in range(1, n_lat):\n        t = np.pi * k / n_lat\n        fig.add_trace(\n            go.Scatter3d(\n                x=np.cos(phi) * np.sin(t),\n                y=np.sin(phi) * np.sin(t),\n                z=np.full_like(phi, np.cos(t)),\n                mode=\"lines\",\n                line=dict(color=line_rgba, width=1),\n                hoverinfo=\"skip\",\n                showlegend=False,\n            )\n        )\n\n\nfig = go.Figure()\nadd_unit_sphere(fig)\n\nfig.add_trace(\n    go.Scatter3d(\n        x=orientations[:, 0],\n        y=orientations[:, 1],\n        z=orientations[:, 2],\n        mode=\"markers\",\n        marker=dict(size=4, color=\"red\"),\n        name=\"Data Points\",\n    )\n)\nfig.add_trace(\n    go.Scatter3d(\n        x=orientations_interp[:, 0],\n        y=orientations_interp[:, 1],\n        z=orientations_interp[:, 2],\n        mode=\"lines\",\n        line=dict(width=5, color=\"blue\"),\n        name=\"Interpolated Curve\",\n    )\n)\n\nfig.update_layout(\n    title=\"Orientation Trajectory on Unit Sphere\",\n    scene=dict(\n        xaxis=dict(title=\"Oi\", range=[-1, 1]),\n        yaxis=dict(title=\"Oj\", range=[-1, 1]),\n        zaxis=dict(title=\"Ok\", range=[-1, 1]),\n        aspectmode=\"cube\",\n        camera=dict(eye=dict(x=1.15, y=-1.15, z=0.85)),\n    ),\n    legend=dict(x=0.02, y=0.98),\n    margin=dict(l=0, r=0, t=40, b=0),\n    height=650,\n    width=650,\n)\n\n# \u5173\u952e\uff1a\u8f93\u51fa\u4e3a HTML\uff0c\u907f\u514d MkDocs/nbconvert \u65e0\u6cd5\u8868\u793a vnd.plotly JSON\nHTML(fig.to_html(full_html=False, include_plotlyjs=\"cdn\"))\n</pre> # Plotly \u5728 MkDocs/nbconvert \u4e0b\u9ed8\u8ba4\u8f93\u51fa\u7684\u662f vnd.plotly JSON\uff0c\u53ef\u80fd\u5bfc\u81f4\u65e0\u6cd5\u5d4c\u5165\u9875\u9762\u7684 warning\u3002 # \u89e3\u51b3\uff1a\u663e\u5f0f\u8f93\u51fa\u4e3a HTML\uff08text/html\uff09\uff0cMkDocs-jupyter \u53ef\u4ee5\u76f4\u63a5\u6e32\u67d3\u3002  from IPython.display import HTML   def add_unit_sphere(fig, n_lon=24, n_lat=12, line_rgba=\"black\"):     theta = np.linspace(0, np.pi, 240)     phi = np.linspace(0, 2 * np.pi, 240)     for k in range(n_lon):         p = 2 * np.pi * k / n_lon         fig.add_trace(             go.Scatter3d(                 x=np.cos(p) * np.sin(theta),                 y=np.sin(p) * np.sin(theta),                 z=np.cos(theta),                 mode=\"lines\",                 line=dict(color=line_rgba, width=1),                 hoverinfo=\"skip\",                 showlegend=False,             )         )     for k in range(1, n_lat):         t = np.pi * k / n_lat         fig.add_trace(             go.Scatter3d(                 x=np.cos(phi) * np.sin(t),                 y=np.sin(phi) * np.sin(t),                 z=np.full_like(phi, np.cos(t)),                 mode=\"lines\",                 line=dict(color=line_rgba, width=1),                 hoverinfo=\"skip\",                 showlegend=False,             )         )   fig = go.Figure() add_unit_sphere(fig)  fig.add_trace(     go.Scatter3d(         x=orientations[:, 0],         y=orientations[:, 1],         z=orientations[:, 2],         mode=\"markers\",         marker=dict(size=4, color=\"red\"),         name=\"Data Points\",     ) ) fig.add_trace(     go.Scatter3d(         x=orientations_interp[:, 0],         y=orientations_interp[:, 1],         z=orientations_interp[:, 2],         mode=\"lines\",         line=dict(width=5, color=\"blue\"),         name=\"Interpolated Curve\",     ) )  fig.update_layout(     title=\"Orientation Trajectory on Unit Sphere\",     scene=dict(         xaxis=dict(title=\"Oi\", range=[-1, 1]),         yaxis=dict(title=\"Oj\", range=[-1, 1]),         zaxis=dict(title=\"Ok\", range=[-1, 1]),         aspectmode=\"cube\",         camera=dict(eye=dict(x=1.15, y=-1.15, z=0.85)),     ),     legend=dict(x=0.02, y=0.98),     margin=dict(l=0, r=0, t=40, b=0),     height=650,     width=650, )  # \u5173\u952e\uff1a\u8f93\u51fa\u4e3a HTML\uff0c\u907f\u514d MkDocs/nbconvert \u65e0\u6cd5\u8868\u793a vnd.plotly JSON HTML(fig.to_html(full_html=False, include_plotlyjs=\"cdn\")) Out[7]: In\u00a0[8]: Copied! <pre># \u9a8c\u8bc1\u59ff\u6001\u59cb\u7ec8\u5f52\u4e00\u5316\nnorms = np.linalg.norm(orientations_interp, axis=1)\nprint(f\"\u59ff\u6001\u6a21\u957f\u7edf\u8ba1: min={norms.min():.10f}, max={norms.max():.10f}\")\nprint(f\"\u2714 \u6240\u6709\u59ff\u6001\u5747\u4e3a\u5355\u4f4d\u5411\u91cf: {np.allclose(norms, 1.0)}\")\n</pre> # \u9a8c\u8bc1\u59ff\u6001\u59cb\u7ec8\u5f52\u4e00\u5316 norms = np.linalg.norm(orientations_interp, axis=1) print(f\"\u59ff\u6001\u6a21\u957f\u7edf\u8ba1: min={norms.min():.10f}, max={norms.max():.10f}\") print(f\"\u2714 \u6240\u6709\u59ff\u6001\u5747\u4e3a\u5355\u4f4d\u5411\u91cf: {np.allclose(norms, 1.0)}\") <pre>\u59ff\u6001\u6a21\u957f\u7edf\u8ba1: min=1.0000000000, max=1.0000000000\n\u2714 \u6240\u6709\u59ff\u6001\u5747\u4e3a\u5355\u4f4d\u5411\u91cf: True\n</pre>"},{"location":"notebooks/02_orientation_spline/#orientation-spline-c3","title":"Orientation Spline: C\u00b3 \u8fde\u7eed\u59ff\u6001\u6837\u6761\u00b6","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 <code>OrientationSpline</code> \u7c7b\u5c06\u79bb\u6563\u5200\u8f74\u59ff\u6001\u62df\u5408\u4e3a C\u00b3 \u8fde\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u6837\u6761\u66f2\u7ebf\u3002</p>"},{"location":"notebooks/02_orientation_spline/#1","title":"1. \u4e3a\u4ec0\u4e48\u7528\u7403\u5750\u6807\uff1f\u00b6","text":"<p>\u5200\u8f74\u59ff\u6001\u662f\u5355\u4f4d\u5411\u91cf $\\mathbf{O} = (O_i, O_j, O_k)^T$\uff0c\u6ee1\u8db3 $\\|\\mathbf{O}\\| = 1$\u3002</p> <p>\u5982\u679c\u76f4\u63a5\u5728\u7b1b\u5361\u5c14\u5750\u6807\u4e0b\u62df\u5408 B \u6837\u6761\uff0c\u63d2\u503c\u7ed3\u679c\u53ef\u80fd\u4e0d\u662f\u5355\u4f4d\u5411\u91cf\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u8f6c\u6362\u5230\u7403\u5750\u6807 $(\\theta, \\phi)$\uff0c\u5728\u7403\u5750\u6807\u5e73\u9762\u62df\u5408 B \u6837\u6761\uff0c\u518d\u6620\u5c04\u56de\u7b1b\u5361\u5c14\u5750\u6807\u3002</p> <p>$$\\mathbf{O} = (\\sin\\theta\\cos\\phi, \\sin\\theta\\sin\\phi, \\cos\\theta)^T$$</p> <p>\u8fd9\u6837\u81ea\u52a8\u4fdd\u8bc1\u4e86 $\\|\\mathbf{O}\\| = 1$\u3002</p>"},{"location":"notebooks/02_orientation_spline/#2","title":"2. \u5feb\u901f\u4e0a\u624b\u00b6","text":""},{"location":"notebooks/02_orientation_spline/#3","title":"3. \u7b97\u6cd5\u539f\u7406\u6982\u8ff0\u00b6","text":"<p><code>OrientationSpline</code> \u7684\u5b9e\u73b0\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff1a</p>"},{"location":"notebooks/02_orientation_spline/#31-b-eq25-31","title":"3.1 \u7403\u5750\u6807 B \u6837\u6761\u62df\u5408 (Eq.25-31)\u00b6","text":"<ol> <li><p>\u5c06\u59ff\u6001\u5411\u91cf\u8f6c\u6362\u4e3a\u7403\u5750\u6807 $(\\theta, \\phi)$\uff1a $$\\theta = \\arccos(O_k), \\quad \\phi = \\text{atan2}(O_j, O_i)$$</p> </li> <li><p>\u5728 $(\\theta, \\phi)$ \u5e73\u9762\u62df\u5408\u4e94\u6b21 B \u6837\u6761</p> </li> <li><p>\u8bc4\u4f30\u65f6\u6620\u5c04\u56de\u7b1b\u5361\u5c14\u5750\u6807</p> </li> </ol> <p>\u89d2\u5ea6\u53c2\u6570\u5316 (Eq.28)\uff1a\u4f7f\u7528\u76f8\u90bb\u59ff\u6001\u95f4\u7684\u89d2\u5ea6\u53d8\u5316\u5206\u914d\u53c2\u6570\u3002</p> <p>\u8be6\u7ec6\u6570\u5b66\u63a8\u5bfc\u89c1 \u7403\u5750\u6807\u59ff\u6001\u7406\u8bba</p>"},{"location":"notebooks/02_orientation_spline/#32-7-bezier-eq32-41","title":"3.2 7\u9636 B\u00e9zier \u91cd\u53c2\u6570\u5316 (Eq.32-41)\u00b6","text":"<p>\u4e3a\u5b9e\u73b0\u5f27\u957f\u53c2\u6570\u5316\uff0c\u9700\u8981\u6784\u5efa\u6620\u5c04 $w(l)$\uff0c\u5c06\u5f27\u957f $l$ \u6620\u5c04\u5230\u59ff\u6001\u6837\u6761\u53c2\u6570 $w$\u3002</p> <p>7\u9636 Bernstein \u591a\u9879\u5f0f (Eq.32-33)\uff1a $$w(r) = \\sum_{i=0}^{7} B_{i,7}(r) Q_i$$</p> <p>\u7ea6\u675f\u6761\u4ef6\uff1a</p> <ul> <li>C\u00b3 \u8fde\u7eed\u6027\uff1a\u6bb5\u95f4\u5bfc\u6570\u8fde\u7eed</li> <li>\u5355\u8c03\u6027\uff1a$Q_0 \\leq Q_1 \\leq \\cdots \\leq Q_7$</li> <li>Jerk \u6700\u5c0f\u5316\uff1a$\\min \\int |w'''(l)|^2 dl$</li> </ul> <p>\u8be6\u7ec6\u6570\u5b66\u63a8\u5bfc\u89c1 B\u00e9zier\u91cd\u53c2\u6570\u5316\u7406\u8bba</p>"},{"location":"notebooks/02_orientation_spline/#4","title":"4. \u53ef\u89c6\u5316\u00b6","text":""},{"location":"notebooks/02_orientation_spline/#5-api","title":"5. API \u53c2\u8003\u00b6","text":""},{"location":"notebooks/02_orientation_spline/#orientationspline","title":"<code>OrientationSpline</code> \u7c7b\u00b6","text":"<pre>class OrientationSpline:\n    def __init__(self, orientations: np.ndarray, arc_lengths: np.ndarray):\n        \"\"\"\n        Args:\n            orientations: (N, 3) \u5200\u8f74\u59ff\u6001\u5411\u91cf\uff08\u5355\u4f4d\u5411\u91cf\uff09\n            arc_lengths: (N,) \u5bf9\u5e94\u7684\u5f27\u957f\u503c\n        \"\"\"\n    \n    def fit(self) -&gt; 'OrientationSpline':\n        \"\"\"\u62df\u5408\u6837\u6761\uff0c\u8fd4\u56de self \u652f\u6301\u94fe\u5f0f\u8c03\u7528\"\"\"\n    \n    def evaluate(self, l: float) -&gt; np.ndarray:\n        \"\"\"\u5728\u5f27\u957f l \u5904\u8bc4\u4f30\u59ff\u6001\uff0c\u8fd4\u56de (3,) \u5355\u4f4d\u5411\u91cf\"\"\"\n    \n    def evaluate_batch(self, l_values: np.ndarray) -&gt; np.ndarray:\n        \"\"\"\u6279\u91cf\u8bc4\u4f30\uff0c\u8fd4\u56de (M, 3) \u5355\u4f4d\u5411\u91cf\u6570\u7ec4\"\"\"\n    \n    @property\n    def length(self) -&gt; float:\n        \"\"\"\u8f68\u8ff9\u603b\u5f27\u957f\"\"\"\n</pre>"},{"location":"notebooks/02_orientation_spline/","title":"\u5c5e\u6027\u00b6","text":"\u5c5e\u6027 \u7c7b\u578b \u8bf4\u660e <code>spline</code> <code>BSpline</code> \u7403\u5750\u6807\u5e73\u9762\u7684 B \u6837\u6761 <code>w_bar</code> <code>ndarray</code> \u53c2\u6570\u5316\u503c <code>reparameterization</code> <code>BezierReparameterization</code> B\u00e9zier \u91cd\u53c2\u6570\u5316\u5bf9\u8c61"},{"location":"notebooks/02_orientation_spline/","title":"\u603b\u7ed3\u00b6","text":"<p><code>OrientationSpline</code> \u901a\u8fc7\u7403\u5750\u6807\u8f6c\u6362\u548c 7 \u9636 B\u00e9zier \u91cd\u53c2\u6570\u5316\uff0c\u5b9e\u73b0\u4e86 C\u00b3 \u8fde\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u59ff\u6001\u6837\u6761\u3002\u7403\u5750\u6807\u8868\u793a\u81ea\u52a8\u4fdd\u8bc1\u4e86\u59ff\u6001\u5411\u91cf\u7684\u5355\u4f4d\u6027\u3002</p>"},{"location":"notebooks/03_inverse_kinematics/","title":"\u9006\u8fd0\u52a8\u5b66","text":"In\u00a0[1]: Copied! <pre>import os\nimport sys\n\nsys.path.insert(0, os.path.abspath(\"../../..\"))\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nfrom cnc_five_axis_interpolation.core.kinematics import (\n    inverse_kinematics_ac,\n    batch_inverse_kinematics_ac,\n)\nfrom cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path\n\n%config InlineBackend.figure_format='retina'\n</pre> import os import sys  sys.path.insert(0, os.path.abspath(\"../../..\")) import numpy as np import matplotlib.pyplot as plt  from cnc_five_axis_interpolation.core.kinematics import (     inverse_kinematics_ac,     batch_inverse_kinematics_ac, ) from cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path  %config InlineBackend.figure_format='retina' In\u00a0[2]: Copied! <pre># \u52a0\u8f7d\u793a\u4f8b\u6570\u636e\npositions, orientations, _ = ijms2021_fan_shaped_path()\nprint(f\"\u6570\u636e\u70b9\u6570: {len(positions)}\")\n</pre> # \u52a0\u8f7d\u793a\u4f8b\u6570\u636e positions, orientations, _ = ijms2021_fan_shaped_path() print(f\"\u6570\u636e\u70b9\u6570: {len(positions)}\") <pre>\u6570\u636e\u70b9\u6570: 25\n</pre> In\u00a0[3]: Copied! <pre># \u5355\u70b9\u9006\u8fd0\u52a8\u5b66\nP = positions[0]  # \u5200\u5c16\u4f4d\u7f6e\nO = orientations[0]  # \u5200\u8f74\u59ff\u6001\n\nXYZ, A, C = inverse_kinematics_ac(P, O, L_ac_z=70.0, L_Tya_z=150.0)\n\nprint(f\"\u5de5\u4ef6\u5750\u6807\u7cfb:\")\nprint(f\"  \u5200\u5c16\u4f4d\u7f6e P = ({P[0]:.2f}, {P[1]:.2f}, {P[2]:.2f}) mm\")\nprint(f\"  \u5200\u8f74\u59ff\u6001 O = ({O[0]:.4f}, {O[1]:.4f}, {O[2]:.4f})\")\nprint(f\"\\n\u673a\u5e8a\u5750\u6807\u7cfb:\")\nprint(f\"  \u7ebf\u6027\u8f74 X={XYZ[0]:.2f}, Y={XYZ[1]:.2f}, Z={XYZ[2]:.2f} mm\")\nprint(f\"  \u65cb\u8f6c\u8f74 A={np.degrees(A):.2f}\u00b0, C={np.degrees(C):.2f}\u00b0\")\n</pre> # \u5355\u70b9\u9006\u8fd0\u52a8\u5b66 P = positions[0]  # \u5200\u5c16\u4f4d\u7f6e O = orientations[0]  # \u5200\u8f74\u59ff\u6001  XYZ, A, C = inverse_kinematics_ac(P, O, L_ac_z=70.0, L_Tya_z=150.0)  print(f\"\u5de5\u4ef6\u5750\u6807\u7cfb:\") print(f\"  \u5200\u5c16\u4f4d\u7f6e P = ({P[0]:.2f}, {P[1]:.2f}, {P[2]:.2f}) mm\") print(f\"  \u5200\u8f74\u59ff\u6001 O = ({O[0]:.4f}, {O[1]:.4f}, {O[2]:.4f})\") print(f\"\\n\u673a\u5e8a\u5750\u6807\u7cfb:\") print(f\"  \u7ebf\u6027\u8f74 X={XYZ[0]:.2f}, Y={XYZ[1]:.2f}, Z={XYZ[2]:.2f} mm\") print(f\"  \u65cb\u8f6c\u8f74 A={np.degrees(A):.2f}\u00b0, C={np.degrees(C):.2f}\u00b0\") <pre>\u5de5\u4ef6\u5750\u6807\u7cfb:\n  \u5200\u5c16\u4f4d\u7f6e P = (113.56, 7.74, -2.21) mm\n  \u5200\u8f74\u59ff\u6001 O = (-0.1073, 0.6249, 0.7733)\n\n\u673a\u5e8a\u5750\u6807\u7cfb:\n  \u7ebf\u6027\u8f74 X=-110.61, Y=-63.74, Z=185.40 mm\n  \u65cb\u8f6c\u8f74 A=39.35\u00b0, C=-9.74\u00b0\n</pre> In\u00a0[4]: Copied! <pre># \u6279\u91cf\u9006\u8fd0\u52a8\u5b66\nXYZ_all, A_all, C_all = batch_inverse_kinematics_ac(\n    positions, orientations, L_ac_z=70.0, L_Tya_z=150.0\n)\n\nprint(f\"\u673a\u5e8a\u5750\u6807\u8303\u56f4:\")\nprint(f\"  X: [{XYZ_all[:, 0].min():.1f}, {XYZ_all[:, 0].max():.1f}] mm\")\nprint(f\"  Y: [{XYZ_all[:, 1].min():.1f}, {XYZ_all[:, 1].max():.1f}] mm\")\nprint(f\"  Z: [{XYZ_all[:, 2].min():.1f}, {XYZ_all[:, 2].max():.1f}] mm\")\nprint(f\"  A: [{np.degrees(A_all).min():.1f}, {np.degrees(A_all).max():.1f}]\u00b0\")\nprint(f\"  C: [{np.degrees(C_all).min():.1f}, {np.degrees(C_all).max():.1f}]\u00b0\")\n</pre> # \u6279\u91cf\u9006\u8fd0\u52a8\u5b66 XYZ_all, A_all, C_all = batch_inverse_kinematics_ac(     positions, orientations, L_ac_z=70.0, L_Tya_z=150.0 )  print(f\"\u673a\u5e8a\u5750\u6807\u8303\u56f4:\") print(f\"  X: [{XYZ_all[:, 0].min():.1f}, {XYZ_all[:, 0].max():.1f}] mm\") print(f\"  Y: [{XYZ_all[:, 1].min():.1f}, {XYZ_all[:, 1].max():.1f}] mm\") print(f\"  Z: [{XYZ_all[:, 2].min():.1f}, {XYZ_all[:, 2].max():.1f}] mm\") print(f\"  A: [{np.degrees(A_all).min():.1f}, {np.degrees(A_all).max():.1f}]\u00b0\") print(f\"  C: [{np.degrees(C_all).min():.1f}, {np.degrees(C_all).max():.1f}]\u00b0\") <pre>\u673a\u5e8a\u5750\u6807\u8303\u56f4:\n  X: [-117.9, 117.9] mm\n  Y: [-110.3, 36.1] mm\n  Z: [149.3, 273.4] mm\n  A: [10.2, 41.5]\u00b0\n  C: [-9.7, 109.9]\u00b0\n</pre> In\u00a0[5]: Copied! <pre># \u9a8c\u8bc1\u89d2\u5ea6\u8ba1\u7b97\nO = orientations[10]\nA_calc = np.arccos(O[2])  # arccos(O_k)\nC_calc = np.arctan2(O[0], O[1])  # atan2(O_i, O_j)\n\nprint(f\"\u59ff\u6001\u5411\u91cf: O = ({O[0]:.4f}, {O[1]:.4f}, {O[2]:.4f})\")\nprint(f\"\u8ba1\u7b97\u7ed3\u679c: A = {np.degrees(A_calc):.2f}\u00b0, C = {np.degrees(C_calc):.2f}\u00b0\")\n</pre> # \u9a8c\u8bc1\u89d2\u5ea6\u8ba1\u7b97 O = orientations[10] A_calc = np.arccos(O[2])  # arccos(O_k) C_calc = np.arctan2(O[0], O[1])  # atan2(O_i, O_j)  print(f\"\u59ff\u6001\u5411\u91cf: O = ({O[0]:.4f}, {O[1]:.4f}, {O[2]:.4f})\") print(f\"\u8ba1\u7b97\u7ed3\u679c: A = {np.degrees(A_calc):.2f}\u00b0, C = {np.degrees(C_calc):.2f}\u00b0\") <pre>\u59ff\u6001\u5411\u91cf: O = (0.1295, 0.2618, 0.9564)\n\u8ba1\u7b97\u7ed3\u679c: A = 16.98\u00b0, C = 26.32\u00b0\n</pre> In\u00a0[6]: Copied! <pre># \u8ba1\u7b97\u5f27\u957f\ndists = np.linalg.norm(np.diff(positions, axis=0), axis=1)\narc_lengths = np.concatenate([[0], np.cumsum(dists)])\n\n# \u7ed8\u5236\u4e94\u8f74\u8fd0\u52a8\u66f2\u7ebf\nfig, axes = plt.subplots(2, 1, figsize=(12, 8), sharex=True)\n\n# \u7ebf\u6027\u8f74\naxes[0].plot(arc_lengths, XYZ_all[:, 0], \"r-\", label=\"X\")\naxes[0].plot(arc_lengths, XYZ_all[:, 1], \"g-\", label=\"Y\")\naxes[0].plot(arc_lengths, XYZ_all[:, 2], \"b-\", label=\"Z\")\naxes[0].set_ylabel(\"Position (mm)\")\naxes[0].legend(loc=\"upper right\")\naxes[0].set_title(\"Machine Linear Axis Motion\")\naxes[0].grid(True, alpha=0.3)\n\n# \u65cb\u8f6c\u8f74\naxes[1].plot(arc_lengths, np.degrees(A_all), \"orange\", label=\"A\")\naxes[1].plot(arc_lengths, np.degrees(C_all), \"purple\", label=\"C\")\naxes[1].set_xlabel(\"Arc Length (mm)\")\naxes[1].set_ylabel(\"Angle (deg)\")\naxes[1].legend(loc=\"upper right\")\naxes[1].set_title(\"Machine Rotary Axis Motion\")\naxes[1].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n</pre> # \u8ba1\u7b97\u5f27\u957f dists = np.linalg.norm(np.diff(positions, axis=0), axis=1) arc_lengths = np.concatenate([[0], np.cumsum(dists)])  # \u7ed8\u5236\u4e94\u8f74\u8fd0\u52a8\u66f2\u7ebf fig, axes = plt.subplots(2, 1, figsize=(12, 8), sharex=True)  # \u7ebf\u6027\u8f74 axes[0].plot(arc_lengths, XYZ_all[:, 0], \"r-\", label=\"X\") axes[0].plot(arc_lengths, XYZ_all[:, 1], \"g-\", label=\"Y\") axes[0].plot(arc_lengths, XYZ_all[:, 2], \"b-\", label=\"Z\") axes[0].set_ylabel(\"Position (mm)\") axes[0].legend(loc=\"upper right\") axes[0].set_title(\"Machine Linear Axis Motion\") axes[0].grid(True, alpha=0.3)  # \u65cb\u8f6c\u8f74 axes[1].plot(arc_lengths, np.degrees(A_all), \"orange\", label=\"A\") axes[1].plot(arc_lengths, np.degrees(C_all), \"purple\", label=\"C\") axes[1].set_xlabel(\"Arc Length (mm)\") axes[1].set_ylabel(\"Angle (deg)\") axes[1].legend(loc=\"upper right\") axes[1].set_title(\"Machine Rotary Axis Motion\") axes[1].grid(True, alpha=0.3)  plt.tight_layout() plt.show() In\u00a0[7]: Copied! <pre># 3D \u5bf9\u6bd4\uff1a\u5de5\u4ef6\u5750\u6807 vs \u673a\u5e8a\u5750\u6807\nfrom mpl_toolkits.mplot3d import Axes3D\n\nfig = plt.figure(figsize=(14, 6))\n\n# \u5de5\u4ef6\u5750\u6807\u7cfb\nax1 = fig.add_subplot(121, projection=\"3d\")\nax1.plot(positions[:, 0], positions[:, 1], positions[:, 2], \"b-\", linewidth=1.5)\nax1.set_xlabel(\"X (mm)\")\nax1.set_ylabel(\"Y (mm)\")\nax1.set_zlabel(\"Z (mm)\")\nax1.set_title(\"Workpiece Coordinate System (WCS)\")\n\n# \u673a\u5e8a\u5750\u6807\u7cfb\nax2 = fig.add_subplot(122, projection=\"3d\")\nax2.plot(XYZ_all[:, 0], XYZ_all[:, 1], XYZ_all[:, 2], \"r-\", linewidth=1.5)\nax2.set_xlabel(\"X (mm)\")\nax2.set_ylabel(\"Y (mm)\")\nax2.set_zlabel(\"Z (mm)\")\nax2.set_title(\"Machine Coordinate System (MCS)\")\n\nplt.tight_layout()\nplt.show()\n</pre> # 3D \u5bf9\u6bd4\uff1a\u5de5\u4ef6\u5750\u6807 vs \u673a\u5e8a\u5750\u6807 from mpl_toolkits.mplot3d import Axes3D  fig = plt.figure(figsize=(14, 6))  # \u5de5\u4ef6\u5750\u6807\u7cfb ax1 = fig.add_subplot(121, projection=\"3d\") ax1.plot(positions[:, 0], positions[:, 1], positions[:, 2], \"b-\", linewidth=1.5) ax1.set_xlabel(\"X (mm)\") ax1.set_ylabel(\"Y (mm)\") ax1.set_zlabel(\"Z (mm)\") ax1.set_title(\"Workpiece Coordinate System (WCS)\")  # \u673a\u5e8a\u5750\u6807\u7cfb ax2 = fig.add_subplot(122, projection=\"3d\") ax2.plot(XYZ_all[:, 0], XYZ_all[:, 1], XYZ_all[:, 2], \"r-\", linewidth=1.5) ax2.set_xlabel(\"X (mm)\") ax2.set_ylabel(\"Y (mm)\") ax2.set_zlabel(\"Z (mm)\") ax2.set_title(\"Machine Coordinate System (MCS)\")  plt.tight_layout() plt.show() In\u00a0[8]: Copied! <pre># \u68c0\u67e5\u662f\u5426\u63a5\u8fd1\u5947\u5f02\u70b9\nA_min = np.degrees(A_all).min()\nprint(f\"A \u8f74\u6700\u5c0f\u503c: {A_min:.2f}\u00b0\")\nif A_min &lt; 5:\n    print(\"\u26a0\ufe0f \u8b66\u544a: \u63a5\u8fd1\u5947\u5f02\u70b9 (A \u2248 0)\")\nelse:\n    print(\"\u2714 \u8f68\u8ff9\u8fdc\u79bb\u5947\u5f02\u70b9\")\n</pre> # \u68c0\u67e5\u662f\u5426\u63a5\u8fd1\u5947\u5f02\u70b9 A_min = np.degrees(A_all).min() print(f\"A \u8f74\u6700\u5c0f\u503c: {A_min:.2f}\u00b0\") if A_min &lt; 5:     print(\"\u26a0\ufe0f \u8b66\u544a: \u63a5\u8fd1\u5947\u5f02\u70b9 (A \u2248 0)\") else:     print(\"\u2714 \u8f68\u8ff9\u8fdc\u79bb\u5947\u5f02\u70b9\") <pre>A \u8f74\u6700\u5c0f\u503c: 10.18\u00b0\n\u2714 \u8f68\u8ff9\u8fdc\u79bb\u5947\u5f02\u70b9\n</pre>"},{"location":"notebooks/03_inverse_kinematics/#inverse-kinematics-a-c","title":"Inverse Kinematics: A-C \u914d\u7f6e\u9006\u8fd0\u52a8\u5b66\u00b6","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u5c06\u5de5\u4ef6\u5750\u6807\u7cfb\u4e0b\u7684\u5200\u5c16\u4f4d\u7f6e\u548c\u5200\u8f74\u59ff\u6001\u8f6c\u6362\u4e3a\u673a\u5e8a\u5750\u6807\u7cfb\u4e0b\u7684\u4e94\u8f74\u8fd0\u52a8 (X, Y, Z, A, C)\u3002</p>"},{"location":"notebooks/03_inverse_kinematics/#1-a-c","title":"1. A-C \u914d\u7f6e\u673a\u5e8a\u51e0\u4f55\u00b6","text":"<p>A-C \u914d\u7f6e\u7684\u4e94\u8f74\u673a\u5e8a\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>A \u8f74\uff1a\u7ed5 X \u8f74\u65cb\u8f6c\uff0c\u63a7\u5236\u5200\u5177\u503e\u659c\u89d2</li> <li>C \u8f74\uff1a\u7ed5 Z \u8f74\u65cb\u8f6c\uff0c\u63a7\u5236\u5de5\u4f5c\u53f0\u65cb\u8f6c</li> <li>X, Y, Z\uff1a\u7ebf\u6027\u8f74\uff0c\u63a7\u5236\u5200\u5177\u5728\u7a7a\u95f4\u4e2d\u7684\u4f4d\u7f6e</li> </ul> <pre><code>        Z\n        |\n        |  A\u8f74(\u7ed5X\u65cb\u8f6c)\n        | /\n        |/_____ Y\n       /\n      X\n     \n    C\u8f74(\u7ed5Z\u65cb\u8f6c, \u5de5\u4f5c\u53f0)\n</code></pre>"},{"location":"notebooks/03_inverse_kinematics/#2","title":"2. \u5feb\u901f\u4e0a\u624b\u00b6","text":""},{"location":"notebooks/03_inverse_kinematics/#3-eq42","title":"3. \u7b97\u6cd5\u539f\u7406 (Eq.42)\u00b6","text":""},{"location":"notebooks/03_inverse_kinematics/#31","title":"3.1 \u65cb\u8f6c\u8f74\u89d2\u5ea6\u8ba1\u7b97\u00b6","text":"<p>\u7ed9\u5b9a\u5200\u8f74\u59ff\u6001 $\\mathbf{O} = (O_i, O_j, O_k)^T$\uff0c\u65cb\u8f6c\u8f74\u89d2\u5ea6\u4e3a\uff1a</p> <p>$$A = \\arccos(O_k)$$ $$C = \\text{atan2}(O_i, O_j)$$</p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>$A$ \u662f\u5200\u8f74\u4e0e Z \u8f74\u7684\u5939\u89d2\uff08\u503e\u659c\u89d2\uff09</li> <li>$C$ \u662f\u5200\u8f74\u5728 XY \u5e73\u9762\u4e0a\u7684\u6295\u5f71\u4e0e Y \u8f74\u7684\u5939\u89d2</li> </ul>"},{"location":"notebooks/03_inverse_kinematics/#32","title":"3.2 \u7ebf\u6027\u8f74\u53d8\u6362\u00b6","text":"<p>\u7ebf\u6027\u8f74\u4f4d\u7f6e\u9700\u8981\u8003\u8651\u65cb\u8f6c\u8f74\u7684\u5f71\u54cd\u548c\u5200\u5177\u504f\u79fb\uff1a</p> <p>$$ \\mathbf{XYZ} = R_C^{-1} \\cdot R_A^{-1} \\cdot (\\mathbf{P} + L_{Tya,z} \\cdot \\mathbf{O}) - \\begin{bmatrix} 0 \\\\ 0 \\\\ L_{ac,z} \\end{bmatrix} $$</p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>$R_A$\uff1a\u7ed5 X \u8f74\u65cb\u8f6c\u77e9\u9635</li> <li>$R_C$\uff1a\u7ed5 Z \u8f74\u65cb\u8f6c\u77e9\u9635</li> <li>$L_{ac,z}$\uff1aA-C \u8f74\u4ea4\u70b9\u5230\u5de5\u4f5c\u53f0\u7684 Z \u504f\u79fb</li> <li>$L_{Tya,z}$\uff1a\u5200\u5177\u957f\u5ea6\u8865\u507f</li> </ul> <p>\u8be6\u7ec6\u6570\u5b66\u63a8\u5bfc\u89c1 A-C\u9006\u8fd0\u52a8\u5b66\u7406\u8bba</p>"},{"location":"notebooks/03_inverse_kinematics/#4","title":"4. \u53ef\u89c6\u5316\u00b6","text":""},{"location":"notebooks/03_inverse_kinematics/#5","title":"5. \u5947\u5f02\u6027\u5206\u6790\u00b6","text":"<p>\u5f53 $A = 0$\uff08\u5200\u8f74\u4e0e Z \u8f74\u5e73\u884c\uff09\u65f6\uff0c$C$ \u89d2\u672a\u5b9a\u4e49\u3002\u8fd9\u662f A-C \u914d\u7f6e\u7684\u5947\u5f02\u70b9\u3002</p> <p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5f53 $A \\approx 0$ \u65f6\uff0c\u53ef\u4ee5\uff1a</p> <ol> <li>\u4fdd\u6301 $C$ \u4e0d\u53d8</li> <li>\u4f7f\u7528\u4e0a\u4e00\u65f6\u523b\u7684 $C$ \u503c</li> </ol>"},{"location":"notebooks/03_inverse_kinematics/#6-api","title":"6. API \u53c2\u8003\u00b6","text":""},{"location":"notebooks/03_inverse_kinematics/#inverse_kinematics_ac","title":"<code>inverse_kinematics_ac</code>\u00b6","text":"<pre>def inverse_kinematics_ac(\n    P: np.ndarray,      # (3,) \u5200\u5c16\u4f4d\u7f6e\n    O: np.ndarray,      # (3,) \u5200\u8f74\u59ff\u6001\uff08\u5355\u4f4d\u5411\u91cf\uff09\n    L_ac_z: float = 0,  # A-C \u8f74\u4ea4\u70b9 Z \u504f\u79fb\n    L_Tya_z: float = 0  # \u5200\u5177\u957f\u5ea6\u88dc\u507f\n) -&gt; tuple[np.ndarray, float, float]:\n    \"\"\"\n    Returns:\n        XYZ: (3,) \u673a\u5e8a\u7ebf\u6027\u8f74\u4f4d\u7f6e\n        A: \u5f27\u5ea6\uff0c\u7ed5 X \u8f74\u65cb\u8f6c\u89d2\n        C: \u5f27\u5ea6\uff0c\u7ed5 Z \u8f74\u65cb\u8f6c\u89d2\n    \"\"\"\n</pre>"},{"location":"notebooks/03_inverse_kinematics/#batch_inverse_kinematics_ac","title":"<code>batch_inverse_kinematics_ac</code>\u00b6","text":"<pre>def batch_inverse_kinematics_ac(\n    positions: np.ndarray,     # (N, 3) \u5200\u5c16\u4f4d\u7f6e\u6570\u7ec4\n    orientations: np.ndarray,  # (N, 3) \u5200\u8f74\u59ff\u6001\u6570\u7ec4\n    L_ac_z: float = 0,\n    L_Tya_z: float = 0\n) -&gt; tuple[np.ndarray, np.ndarray, np.ndarray]:\n    \"\"\"\n    Returns:\n        XYZ: (N, 3) \u673a\u5e8a\u7ebf\u6027\u8f74\u4f4d\u7f6e\n        A: (N,) \u5f27\u5ea6\u6570\u7ec4\n        C: (N,) \u5f27\u5ea6\u6570\u7ec4\n    \"\"\"\n</pre>"},{"location":"notebooks/03_inverse_kinematics/","title":"\u603b\u7ed3\u00b6","text":"<p>A-C \u914d\u7f6e\u9006\u8fd0\u52a8\u5b66\u5c06\u5de5\u4ef6\u5750\u6807\u7cfb\u4e0b\u7684\u5200\u5c16\u4f4d\u7f6e\u548c\u5200\u8f74\u59ff\u6001\u8f6c\u6362\u4e3a\u673a\u5e8a\u7684\u4e94\u8f74\u8fd0\u52a8\u3002\u65cb\u8f6c\u8f74\u89d2\u5ea6\u76f4\u63a5\u7531\u59ff\u6001\u5411\u91cf\u8ba1\u7b97\uff0c\u7ebf\u6027\u8f74\u4f4d\u7f6e\u9700\u8003\u8651\u65cb\u8f6c\u8f74\u5f71\u54cd\u548c\u5200\u5177\u504f\u79fb\u3002</p>"},{"location":"notebooks/04_end_to_end_example/","title":"\u7aef\u5230\u7aef\u793a\u4f8b","text":"In\u00a0[1]: Copied! <pre>import os\nimport sys\n\nsys.path.insert(0, os.path.abspath(\"../../..\"))\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.mplot3d import Axes3D\n\nfrom cnc_five_axis_interpolation import FiveAxisPath\nfrom cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path\n\n%config InlineBackend.figure_format='retina'\n</pre> import os import sys  sys.path.insert(0, os.path.abspath(\"../../..\"))  import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D  from cnc_five_axis_interpolation import FiveAxisPath from cnc_five_axis_interpolation.datasets import ijms2021_fan_shaped_path  %config InlineBackend.figure_format='retina' In\u00a0[2]: Copied! <pre># \u52a0\u8f7d IJMS2021 \u6247\u5f62\u8def\u5f84\u6570\u636e\npositions, orientations, constraints = ijms2021_fan_shaped_path()\n\nprint(f\"\u6570\u636e\u70b9\u6570: {len(positions)}\")\nprint(f\"\u4f4d\u7f6e\u8303\u56f4:\")\nprint(f\"  X: [{positions[:, 0].min():.1f}, {positions[:, 0].max():.1f}] mm\")\nprint(f\"  Y: [{positions[:, 1].min():.1f}, {positions[:, 1].max():.1f}] mm\")\nprint(f\"  Z: [{positions[:, 2].min():.1f}, {positions[:, 2].max():.1f}] mm\")\n</pre> # \u52a0\u8f7d IJMS2021 \u6247\u5f62\u8def\u5f84\u6570\u636e positions, orientations, constraints = ijms2021_fan_shaped_path()  print(f\"\u6570\u636e\u70b9\u6570: {len(positions)}\") print(f\"\u4f4d\u7f6e\u8303\u56f4:\") print(f\"  X: [{positions[:, 0].min():.1f}, {positions[:, 0].max():.1f}] mm\") print(f\"  Y: [{positions[:, 1].min():.1f}, {positions[:, 1].max():.1f}] mm\") print(f\"  Z: [{positions[:, 2].min():.1f}, {positions[:, 2].max():.1f}] mm\") <pre>\u6570\u636e\u70b9\u6570: 25\n\u4f4d\u7f6e\u8303\u56f4:\n  X: [-49.4, 117.9] mm\n  Y: [-118.0, 7.7] mm\n  Z: [-6.2, 7.0] mm\n</pre> In\u00a0[3]: Copied! <pre># \u53ef\u89c6\u5316\u539f\u59cb\u79bb\u6563\u70b9\u548c\u59ff\u6001\nfig = plt.figure(figsize=(10, 8))\nax = fig.add_subplot(111, projection=\"3d\")\n\n# \u7ed8\u5236\u79bb\u6563\u70b9\nax.scatter(\n    positions[:, 0],\n    positions[:, 1],\n    positions[:, 2],\n    c=\"green\",\n    marker=\"o\",\n    s=20,\n    alpha=0.6,\n    label=\"Discrete Points\",\n)\n\narrow_length = 5\nax.quiver(\n    positions[:, 0],\n    positions[:, 1],\n    positions[:, 2],\n    orientations[:, 0] * arrow_length,\n    orientations[:, 1] * arrow_length,\n    orientations[:, 2] * arrow_length,\n    color=\"red\",\n    alpha=0.8,\n    label=\"Tool Orientations\",\n)\n\nax.set_xlabel(\"X (mm)\")\nax.set_ylabel(\"Y (mm)\")\nax.set_zlabel(\"Z (mm)\")\nax.set_title(\"Raw Discrete Data Points and Orientations\")\nax.legend()\n\nplt.tight_layout()\nplt.show()\n</pre> # \u53ef\u89c6\u5316\u539f\u59cb\u79bb\u6563\u70b9\u548c\u59ff\u6001 fig = plt.figure(figsize=(10, 8)) ax = fig.add_subplot(111, projection=\"3d\")  # \u7ed8\u5236\u79bb\u6563\u70b9 ax.scatter(     positions[:, 0],     positions[:, 1],     positions[:, 2],     c=\"green\",     marker=\"o\",     s=20,     alpha=0.6,     label=\"Discrete Points\", )  arrow_length = 5 ax.quiver(     positions[:, 0],     positions[:, 1],     positions[:, 2],     orientations[:, 0] * arrow_length,     orientations[:, 1] * arrow_length,     orientations[:, 2] * arrow_length,     color=\"red\",     alpha=0.8,     label=\"Tool Orientations\", )  ax.set_xlabel(\"X (mm)\") ax.set_ylabel(\"Y (mm)\") ax.set_zlabel(\"Z (mm)\") ax.set_title(\"Raw Discrete Data Points and Orientations\") ax.legend()  plt.tight_layout() plt.show()  In\u00a0[4]: Copied! <pre># \u521b\u5efa\u5e76\u62df\u5408\u4e94\u8f74\u8def\u5f84\npath = FiveAxisPath(positions, orientations, mse_tolerance=1e-6)\npath.fit()\n\nprint(f\"\u8f68\u8ff9\u603b\u5f27\u957f: {path.length:.2f} mm\")\nprint(f\"\u4f4d\u7f6e\u6837\u6761\u6bb5\u6570: {len(path.position_spline.feed_corrections)}\")\n</pre> # \u521b\u5efa\u5e76\u62df\u5408\u4e94\u8f74\u8def\u5f84 path = FiveAxisPath(positions, orientations, mse_tolerance=1e-6) path.fit()  print(f\"\u8f68\u8ff9\u603b\u5f27\u957f: {path.length:.2f} mm\") print(f\"\u4f4d\u7f6e\u6837\u6761\u6bb5\u6570: {len(path.position_spline.feed_corrections)}\") <pre>\u8f68\u8ff9\u603b\u5f27\u957f: 344.79 mm\n\u4f4d\u7f6e\u6837\u6761\u6bb5\u6570: 8\n</pre> In\u00a0[5]: Copied! <pre># \u6cbf\u5f27\u957f\u5747\u5300\u91c7\u6837\nn_samples = 200\nl_values = np.linspace(0, path.length, n_samples)\n\n# \u8bc4\u4f30\u4f4d\u7f6e\u548c\u59ff\u6001\npos_interp = path.position_spline.evaluate_batch(l_values)\nori_interp = path.orientation_spline.evaluate_batch(l_values)\n\nprint(f\"\u91c7\u6837\u70b9\u6570: {n_samples}\")\nprint(f\"\u91c7\u6837\u95f4\u9694: {path.length / (n_samples - 1):.3f} mm\")\n</pre> # \u6cbf\u5f27\u957f\u5747\u5300\u91c7\u6837 n_samples = 200 l_values = np.linspace(0, path.length, n_samples)  # \u8bc4\u4f30\u4f4d\u7f6e\u548c\u59ff\u6001 pos_interp = path.position_spline.evaluate_batch(l_values) ori_interp = path.orientation_spline.evaluate_batch(l_values)  print(f\"\u91c7\u6837\u70b9\u6570: {n_samples}\") print(f\"\u91c7\u6837\u95f4\u9694: {path.length / (n_samples - 1):.3f} mm\") <pre>\u91c7\u6837\u70b9\u6570: 200\n\u91c7\u6837\u95f4\u9694: 1.733 mm\n</pre> In\u00a0[6]: Copied! <pre># \u8ba1\u7b97\u673a\u5e8a\u4e94\u8f74\u5750\u6807 (\u4f7f\u7528 FiveAxisPath \u9ed8\u8ba4\u7684 L_ac_z=70.0, L_Tya_z=150.0)\nXYZ, A, C = path.evaluate_machine_coords_batch(l_values)\n\nprint(f\"\u673a\u5e8a\u5750\u6807\u8303\u56f4:\")\nprint(f\"  X: [{XYZ[:, 0].min():.1f}, {XYZ[:, 0].max():.1f}] mm\")\nprint(f\"  Y: [{XYZ[:, 1].min():.1f}, {XYZ[:, 1].max():.1f}] mm\")\nprint(f\"  Z: [{XYZ[:, 2].min():.1f}, {XYZ[:, 2].max():.1f}] mm\")\nprint(f\"  A: [{np.degrees(A).min():.1f}, {np.degrees(A).max():.1f}]\u00b0\")\nprint(f\"  C: [{np.degrees(C).min():.1f}, {np.degrees(C).max():.1f}]\u00b0\")\n</pre> # \u8ba1\u7b97\u673a\u5e8a\u4e94\u8f74\u5750\u6807 (\u4f7f\u7528 FiveAxisPath \u9ed8\u8ba4\u7684 L_ac_z=70.0, L_Tya_z=150.0) XYZ, A, C = path.evaluate_machine_coords_batch(l_values)  print(f\"\u673a\u5e8a\u5750\u6807\u8303\u56f4:\") print(f\"  X: [{XYZ[:, 0].min():.1f}, {XYZ[:, 0].max():.1f}] mm\") print(f\"  Y: [{XYZ[:, 1].min():.1f}, {XYZ[:, 1].max():.1f}] mm\") print(f\"  Z: [{XYZ[:, 2].min():.1f}, {XYZ[:, 2].max():.1f}] mm\") print(f\"  A: [{np.degrees(A).min():.1f}, {np.degrees(A).max():.1f}]\u00b0\") print(f\"  C: [{np.degrees(C).min():.1f}, {np.degrees(C).max():.1f}]\u00b0\") <pre>\u673a\u5e8a\u5750\u6807\u8303\u56f4:\n  X: [-117.9, 117.9] mm\n  Y: [-110.3, 36.5] mm\n  Z: [149.3, 273.6] mm\n  A: [10.2, 41.5]\u00b0\n  C: [-9.7, 109.9]\u00b0\n</pre> In\u00a0[7]: Copied! <pre># 3D \u8f68\u8ff9 + \u59ff\u6001\u7bad\u5934\nfig = plt.figure(figsize=(12, 10))\nax = fig.add_subplot(111, projection=\"3d\")\n\n# \u8f68\u8ff9\u66f2\u7ebf\nax.plot(\n    pos_interp[:, 0],\n    pos_interp[:, 1],\n    pos_interp[:, 2],\n    \"b-\",\n    linewidth=1.5,\n    label=\"Tool Tip Path\",\n)\n\narrow_length = 5\n\nax.quiver(\n    pos_interp[:, 0],\n    pos_interp[:, 1],\n    pos_interp[:, 2],\n    ori_interp[:, 0] * arrow_length,\n    ori_interp[:, 1] * arrow_length,\n    ori_interp[:, 2] * arrow_length,\n    color=\"green\",\n    alpha=0.7,\n    arrow_length_ratio=0.3,\n)\n\n\nend_intrep = pos_interp + ori_interp * arrow_length\nax.plot(\n    end_intrep[:, 0],\n    end_intrep[:, 1],\n    end_intrep[:, 2],\n    \"k-\",\n    linewidth=1.5,\n    # label=\"Tool Orientation\",\n)\n\nax.scatter(\n    positions[:, 0],\n    positions[:, 1],\n    positions[:, 2],\n    c=\"red\",\n    s=20,\n    alpha=0.5,\n    label=\"Data Points\",\n)\n\nax.set_xlabel(\"X (mm)\")\nax.set_ylabel(\"Y (mm)\")\nax.set_zlabel(\"Z (mm)\")\nax.set_title(\"5-Axis Tool Tip Path and Orientation\")\nax.legend()\n\nplt.tight_layout()\nplt.show()\n</pre> # 3D \u8f68\u8ff9 + \u59ff\u6001\u7bad\u5934 fig = plt.figure(figsize=(12, 10)) ax = fig.add_subplot(111, projection=\"3d\")  # \u8f68\u8ff9\u66f2\u7ebf ax.plot(     pos_interp[:, 0],     pos_interp[:, 1],     pos_interp[:, 2],     \"b-\",     linewidth=1.5,     label=\"Tool Tip Path\", )  arrow_length = 5  ax.quiver(     pos_interp[:, 0],     pos_interp[:, 1],     pos_interp[:, 2],     ori_interp[:, 0] * arrow_length,     ori_interp[:, 1] * arrow_length,     ori_interp[:, 2] * arrow_length,     color=\"green\",     alpha=0.7,     arrow_length_ratio=0.3, )   end_intrep = pos_interp + ori_interp * arrow_length ax.plot(     end_intrep[:, 0],     end_intrep[:, 1],     end_intrep[:, 2],     \"k-\",     linewidth=1.5,     # label=\"Tool Orientation\", )  ax.scatter(     positions[:, 0],     positions[:, 1],     positions[:, 2],     c=\"red\",     s=20,     alpha=0.5,     label=\"Data Points\", )  ax.set_xlabel(\"X (mm)\") ax.set_ylabel(\"Y (mm)\") ax.set_zlabel(\"Z (mm)\") ax.set_title(\"5-Axis Tool Tip Path and Orientation\") ax.legend()  plt.tight_layout() plt.show() In\u00a0[8]: Copied! <pre># \u4e94\u8f74\u8fd0\u52a8\u66f2\u7ebf\nfig, axes = plt.subplots(5, 1, figsize=(12, 12), sharex=True)\n\naxes[0].plot(l_values, XYZ[:, 0], \"r-\")\naxes[0].set_ylabel(\"X (mm)\")\naxes[0].grid(True, alpha=0.3)\n\naxes[1].plot(l_values, XYZ[:, 1], \"g-\")\naxes[1].set_ylabel(\"Y (mm)\")\naxes[1].grid(True, alpha=0.3)\n\naxes[2].plot(l_values, XYZ[:, 2], \"b-\")\naxes[2].set_ylabel(\"Z (mm)\")\naxes[2].grid(True, alpha=0.3)\n\naxes[3].plot(l_values, np.degrees(A), \"orange\")\naxes[3].set_ylabel(\"A (deg)\")\naxes[3].grid(True, alpha=0.3)\n\naxes[4].plot(l_values, np.degrees(C), \"purple\")\naxes[4].set_ylabel(\"C (deg)\")\naxes[4].set_xlabel(\"Arc Length (mm)\")\naxes[4].grid(True, alpha=0.3)\n\nfig.suptitle(\"Machine 5-Axis Motion Curves\", fontsize=14)\nplt.tight_layout()\nplt.show()\n</pre> # \u4e94\u8f74\u8fd0\u52a8\u66f2\u7ebf fig, axes = plt.subplots(5, 1, figsize=(12, 12), sharex=True)  axes[0].plot(l_values, XYZ[:, 0], \"r-\") axes[0].set_ylabel(\"X (mm)\") axes[0].grid(True, alpha=0.3)  axes[1].plot(l_values, XYZ[:, 1], \"g-\") axes[1].set_ylabel(\"Y (mm)\") axes[1].grid(True, alpha=0.3)  axes[2].plot(l_values, XYZ[:, 2], \"b-\") axes[2].set_ylabel(\"Z (mm)\") axes[2].grid(True, alpha=0.3)  axes[3].plot(l_values, np.degrees(A), \"orange\") axes[3].set_ylabel(\"A (deg)\") axes[3].grid(True, alpha=0.3)  axes[4].plot(l_values, np.degrees(C), \"purple\") axes[4].set_ylabel(\"C (deg)\") axes[4].set_xlabel(\"Arc Length (mm)\") axes[4].grid(True, alpha=0.3)  fig.suptitle(\"Machine 5-Axis Motion Curves\", fontsize=14) plt.tight_layout() plt.show() In\u00a0[9]: Copied! <pre># \u6570\u503c\u5fae\u5206\u9a8c\u8bc1 jerk \u8fde\u7eed\u6027\nh = 0.05  # \u5f27\u957f\u6b65\u957f\nl_test = np.arange(2 * h, path.length - 2 * h, h)\n\n\ndef compute_derivatives(spline, l_arr, h):\n    \"\"\"\u8ba1\u7b97\u4f4d\u7f6e\u7684\u5404\u9636\u5bfc\u6570\"\"\"\n    pos = spline.evaluate_batch(l_arr)\n\n    # \u901f\u5ea6 (\u4e00\u9636\u5bfc\u6570)\n    pos_p = spline.evaluate_batch(l_arr + h)\n    pos_m = spline.evaluate_batch(l_arr - h)\n    velocity = (pos_p - pos_m) / (2 * h)\n\n    # \u52a0\u901f\u5ea6 (\u4e8c\u9636\u5bfc\u6570)\n    accel = (pos_p - 2 * pos + pos_m) / (h**2)\n\n    # Jerk (\u4e09\u9636\u5bfc\u6570)\n    pos_pp = spline.evaluate_batch(l_arr + 2 * h)\n    pos_mm = spline.evaluate_batch(l_arr - 2 * h)\n    jerk = (pos_pp - 2 * pos_p + 2 * pos_m - pos_mm) / (2 * h**3)\n\n    return velocity, accel, jerk\n\n\nvelocity, accel, jerk = compute_derivatives(path.position_spline, l_test, h)\n\n# \u8ba1\u7b97\u6a21\u957f\nspeed = np.linalg.norm(velocity, axis=1)\naccel_mag = np.linalg.norm(accel, axis=1)\njerk_mag = np.linalg.norm(jerk, axis=1)\n</pre> # \u6570\u503c\u5fae\u5206\u9a8c\u8bc1 jerk \u8fde\u7eed\u6027 h = 0.05  # \u5f27\u957f\u6b65\u957f l_test = np.arange(2 * h, path.length - 2 * h, h)   def compute_derivatives(spline, l_arr, h):     \"\"\"\u8ba1\u7b97\u4f4d\u7f6e\u7684\u5404\u9636\u5bfc\u6570\"\"\"     pos = spline.evaluate_batch(l_arr)      # \u901f\u5ea6 (\u4e00\u9636\u5bfc\u6570)     pos_p = spline.evaluate_batch(l_arr + h)     pos_m = spline.evaluate_batch(l_arr - h)     velocity = (pos_p - pos_m) / (2 * h)      # \u52a0\u901f\u5ea6 (\u4e8c\u9636\u5bfc\u6570)     accel = (pos_p - 2 * pos + pos_m) / (h**2)      # Jerk (\u4e09\u9636\u5bfc\u6570)     pos_pp = spline.evaluate_batch(l_arr + 2 * h)     pos_mm = spline.evaluate_batch(l_arr - 2 * h)     jerk = (pos_pp - 2 * pos_p + 2 * pos_m - pos_mm) / (2 * h**3)      return velocity, accel, jerk   velocity, accel, jerk = compute_derivatives(path.position_spline, l_test, h)  # \u8ba1\u7b97\u6a21\u957f speed = np.linalg.norm(velocity, axis=1) accel_mag = np.linalg.norm(accel, axis=1) jerk_mag = np.linalg.norm(jerk, axis=1) In\u00a0[10]: Copied! <pre># \u7ed8\u5236\u5bfc\u6570\u66f2\u7ebf\nfig, axes = plt.subplots(3, 1, figsize=(12, 9), sharex=True)\n\naxes[0].plot(l_test, speed, \"b-\", linewidth=1)\naxes[0].set_ylabel(\"Speed |dP/dl|\")\naxes[0].set_title(\"C\u00b3 Continuity Verification: Velocity/Acceleration/Jerk\")\naxes[0].grid(True, alpha=0.3)\n\naxes[1].plot(l_test, accel_mag, \"g-\", linewidth=1)\naxes[1].set_ylabel(\"Accel |d\u00b2P/dl\u00b2|\")\naxes[1].grid(True, alpha=0.3)\n\naxes[2].plot(l_test, jerk_mag, \"r-\", linewidth=1)\naxes[2].set_ylabel(\"Jerk |d\u00b3P/dl\u00b3|\")\naxes[2].set_xlabel(\"Arc Length (mm)\")\naxes[2].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n\nprint(f\"Jerk \u7edf\u8ba1:\")\nprint(f\"  \u6700\u5927\u503c: {jerk_mag.max():.4f}\")\nprint(f\"  \u5e73\u5747\u503c: {jerk_mag.mean():.4f}\")\nprint(f\"  \u6807\u51c6\u5dee: {jerk_mag.std():.4f}\")\nprint(f\"\\n\u2714 Jerk \u66f2\u7ebf\u8fde\u7eed\u65e0\u7a81\u53d8\uff0c\u8bc1\u660e C\u00b3 \u8fde\u7eed\u6027\")\n</pre> # \u7ed8\u5236\u5bfc\u6570\u66f2\u7ebf fig, axes = plt.subplots(3, 1, figsize=(12, 9), sharex=True)  axes[0].plot(l_test, speed, \"b-\", linewidth=1) axes[0].set_ylabel(\"Speed |dP/dl|\") axes[0].set_title(\"C\u00b3 Continuity Verification: Velocity/Acceleration/Jerk\") axes[0].grid(True, alpha=0.3)  axes[1].plot(l_test, accel_mag, \"g-\", linewidth=1) axes[1].set_ylabel(\"Accel |d\u00b2P/dl\u00b2|\") axes[1].grid(True, alpha=0.3)  axes[2].plot(l_test, jerk_mag, \"r-\", linewidth=1) axes[2].set_ylabel(\"Jerk |d\u00b3P/dl\u00b3|\") axes[2].set_xlabel(\"Arc Length (mm)\") axes[2].grid(True, alpha=0.3)  plt.tight_layout() plt.show()  print(f\"Jerk \u7edf\u8ba1:\") print(f\"  \u6700\u5927\u503c: {jerk_mag.max():.4f}\") print(f\"  \u5e73\u5747\u503c: {jerk_mag.mean():.4f}\") print(f\"  \u6807\u51c6\u5dee: {jerk_mag.std():.4f}\") print(f\"\\n\u2714 Jerk \u66f2\u7ebf\u8fde\u7eed\u65e0\u7a81\u53d8\uff0c\u8bc1\u660e C\u00b3 \u8fde\u7eed\u6027\") <pre>Jerk \u7edf\u8ba1:\n  \u6700\u5927\u503c: 0.0406\n  \u5e73\u5747\u503c: 0.0033\n  \u6807\u51c6\u5dee: 0.0062\n\n\u2714 Jerk \u66f2\u7ebf\u8fde\u7eed\u65e0\u7a81\u53d8\uff0c\u8bc1\u660e C\u00b3 \u8fde\u7eed\u6027\n</pre> In\u00a0[11]: Copied! <pre>from scipy.interpolate import CubicSpline\n\n# \u6784\u5efa C\u00b2 \u8fde\u7eed\u7684\u4e09\u6b21\u6837\u6761 (\u4f5c\u4e3a\u5bf9\u6bd4)\ndists = np.linalg.norm(np.diff(positions, axis=0), axis=1)\narc_lengths_data = np.concatenate([[0], np.cumsum(dists)])\n\n# \u5bf9\u6bcf\u4e2a\u5750\u6807\u5206\u522b\u62df\u5408\u4e09\u6b21\u6837\u6761\ncs_x = CubicSpline(arc_lengths_data, positions[:, 0])\ncs_y = CubicSpline(arc_lengths_data, positions[:, 1])\ncs_z = CubicSpline(arc_lengths_data, positions[:, 2])\n\n# \u8ba1\u7b97 C\u00b2 \u6837\u6761\u7684 jerk\nl_compare = np.linspace(0.1, arc_lengths_data[-1] - 0.1, 500)\n\n# C\u00b2: \u4e09\u9636\u5bfc\u6570\njerk_c2_x = cs_x(l_compare, 3)\njerk_c2_y = cs_y(l_compare, 3)\njerk_c2_z = cs_z(l_compare, 3)\njerk_c2_mag = np.sqrt(jerk_c2_x**2 + jerk_c2_y**2 + jerk_c2_z**2)\n\n# C\u00b3: \u6570\u503c\u5fae\u5206\n_, _, jerk_c3 = compute_derivatives(path.position_spline, l_compare, 0.05)\njerk_c3_mag = np.linalg.norm(jerk_c3, axis=1)\n</pre> from scipy.interpolate import CubicSpline  # \u6784\u5efa C\u00b2 \u8fde\u7eed\u7684\u4e09\u6b21\u6837\u6761 (\u4f5c\u4e3a\u5bf9\u6bd4) dists = np.linalg.norm(np.diff(positions, axis=0), axis=1) arc_lengths_data = np.concatenate([[0], np.cumsum(dists)])  # \u5bf9\u6bcf\u4e2a\u5750\u6807\u5206\u522b\u62df\u5408\u4e09\u6b21\u6837\u6761 cs_x = CubicSpline(arc_lengths_data, positions[:, 0]) cs_y = CubicSpline(arc_lengths_data, positions[:, 1]) cs_z = CubicSpline(arc_lengths_data, positions[:, 2])  # \u8ba1\u7b97 C\u00b2 \u6837\u6761\u7684 jerk l_compare = np.linspace(0.1, arc_lengths_data[-1] - 0.1, 500)  # C\u00b2: \u4e09\u9636\u5bfc\u6570 jerk_c2_x = cs_x(l_compare, 3) jerk_c2_y = cs_y(l_compare, 3) jerk_c2_z = cs_z(l_compare, 3) jerk_c2_mag = np.sqrt(jerk_c2_x**2 + jerk_c2_y**2 + jerk_c2_z**2)  # C\u00b3: \u6570\u503c\u5fae\u5206 _, _, jerk_c3 = compute_derivatives(path.position_spline, l_compare, 0.05) jerk_c3_mag = np.linalg.norm(jerk_c3, axis=1) In\u00a0[12]: Copied! <pre># \u5bf9\u6bd4\u56fe\nfig, ax = plt.subplots(figsize=(12, 5))\n\nax.plot(l_compare, jerk_c2_mag, \"r-\", linewidth=1, alpha=0.7, label=\"C\u00b2 (Cubic Spline)\")\nax.plot(l_compare, jerk_c3_mag, \"b-\", linewidth=1, alpha=0.7, label=\"C\u00b3 (Yuen et al.)\")\n\nax.set_xlabel(\"Arc Length (mm)\")\nax.set_ylabel(\"Jerk |d\u00b3P/dl\u00b3|\")\nax.set_title(\"C\u00b2 vs C\u00b3 Jerk Comparison\")\nax.legend()\nax.grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n\nprint(f\"Jerk \u5bf9\u6bd4:\")\nprint(f\"  C\u00b2 \u6700\u5927\u503c: {jerk_c2_mag.max():.4f}\")\nprint(f\"  C\u00b3 \u6700\u5927\u503c: {jerk_c3_mag.max():.4f}\")\nprint(f\"\\n  C\u00b2 jerk \u6709\u660e\u663e\u7a81\u53d8\uff08\u4e0d\u8fde\u7eed\uff09\")\nprint(f\"  C\u00b3 jerk \u5e73\u6ed1\u8fde\u7eed\")\n</pre> # \u5bf9\u6bd4\u56fe fig, ax = plt.subplots(figsize=(12, 5))  ax.plot(l_compare, jerk_c2_mag, \"r-\", linewidth=1, alpha=0.7, label=\"C\u00b2 (Cubic Spline)\") ax.plot(l_compare, jerk_c3_mag, \"b-\", linewidth=1, alpha=0.7, label=\"C\u00b3 (Yuen et al.)\")  ax.set_xlabel(\"Arc Length (mm)\") ax.set_ylabel(\"Jerk |d\u00b3P/dl\u00b3|\") ax.set_title(\"C\u00b2 vs C\u00b3 Jerk Comparison\") ax.legend() ax.grid(True, alpha=0.3)  plt.tight_layout() plt.show()  print(f\"Jerk \u5bf9\u6bd4:\") print(f\"  C\u00b2 \u6700\u5927\u503c: {jerk_c2_mag.max():.4f}\") print(f\"  C\u00b3 \u6700\u5927\u503c: {jerk_c3_mag.max():.4f}\") print(f\"\\n  C\u00b2 jerk \u6709\u660e\u663e\u7a81\u53d8\uff08\u4e0d\u8fde\u7eed\uff09\") print(f\"  C\u00b3 jerk \u5e73\u6ed1\u8fde\u7eed\") <pre>Jerk \u5bf9\u6bd4:\n  C\u00b2 \u6700\u5927\u503c: 0.0380\n  C\u00b3 \u6700\u5927\u503c: 0.0404\n\n  C\u00b2 jerk \u6709\u660e\u663e\u7a81\u53d8\uff08\u4e0d\u8fde\u7eed\uff09\n  C\u00b3 jerk \u5e73\u6ed1\u8fde\u7eed\n</pre>"},{"location":"notebooks/04_end_to_end_example/#end-to-end-example","title":"End-to-End Example: \u5b8c\u6574\u4e94\u8f74\u8f68\u8ff9\u751f\u6210\u6d41\u7a0b\u00b6","text":"<p>\u672c\u6587\u6863\u5c55\u793a\u5982\u4f55\u4f7f\u7528 <code>FiveAxisPath</code> \u7c7b\u5b8c\u6210\u4ece\u79bb\u6563\u6570\u636e\u70b9\u5230\u673a\u5e8a\u4e94\u8f74\u8fd0\u52a8\u7684\u5b8c\u6574\u6d41\u7a0b\u3002</p>"},{"location":"notebooks/04_end_to_end_example/#1","title":"1. \u6d41\u7a0b\u6982\u89c8\u00b6","text":"<pre><code>\u79bb\u6563\u6570\u636e\u70b9 (P, O)\n       \u2193\n\u4e94\u6b21 B \u6837\u6761\u62df\u5408\n       \u2193\n\u5f27\u957f\u53c2\u6570\u5316 (C\u00b3 \u8fde\u7eed)\n       \u2193\n\u9006\u8fd0\u52a8\u5b66\u53d8\u6362\n       \u2193\n\u673a\u5e8a\u4e94\u8f74\u8fd0\u52a8 (X, Y, Z, A, C)\n</code></pre>"},{"location":"notebooks/04_end_to_end_example/#2","title":"2. \u6570\u636e\u52a0\u8f7d\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#3","title":"3. \u8f68\u8ff9\u62df\u5408\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#4","title":"4. \u5747\u5300\u91c7\u6837\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#5","title":"5. \u673a\u5e8a\u5750\u6807\u53d8\u6362\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#6","title":"6. \u53ef\u89c6\u5316\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#7-c3","title":"7. C\u00b3 \u8fde\u7eed\u6027\u9a8c\u8bc1\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#8-c2-vs-c3","title":"8. C\u00b2 vs C\u00b3 \u5bf9\u6bd4\u00b6","text":"<p>\u4e0b\u9762\u5bf9\u6bd4 C\u00b2 \u8fde\u7eed\uff08\u666e\u901a\u4e09\u6b21\u6837\u6761\uff09\u548c C\u00b3 \u8fde\u7eed\uff08\u672c\u7b97\u6cd5\uff09\u7684 jerk \u5dee\u5f02\u3002</p>"},{"location":"notebooks/04_end_to_end_example/#9-api","title":"9. API \u53c2\u8003\u00b6","text":""},{"location":"notebooks/04_end_to_end_example/#fiveaxispath","title":"<code>FiveAxisPath</code> \u7c7b\u00b6","text":"<pre>class FiveAxisPath:\n    def __init__(self, positions: np.ndarray, orientations: np.ndarray, \n                 mse_tolerance: float = 1e-6,\n                 L_ac_z: float = 70.0, L_Tya_z: float = 150.0):\n        \"\"\"\n        Args:\n            positions: (N, 3) \u5200\u5c16\u4f4d\u7f6e\n            orientations: (N, 3) \u5200\u8f74\u59ff\u6001\uff08\u5355\u4f4d\u5411\u91cf\uff09\n            mse_tolerance: \u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f MSE \u5bb9\u5dee\n            L_ac_z: A\u8f74\u5230C\u8f74\u7684Z\u65b9\u5411\u504f\u79fb (mm)\n            L_Tya_z: \u4e3b\u8f74\u5230A\u8f74\u7684Z\u65b9\u5411\u504f\u79fb (mm)\n        \"\"\"\n    \n    def fit(self) -&gt; 'FiveAxisPath':\n        \"\"\"\u62df\u5408\u4f4d\u7f6e\u548c\u59ff\u6001\u6837\u6761\"\"\"\n    \n    def evaluate(self, l: float) -&gt; tuple[np.ndarray, np.ndarray]:\n        \"\"\"\u5728\u5f27\u957f l \u5904\u8bc4\u4f30\u4f4d\u7f6e\u548c\u59ff\u6001\"\"\"\n    \n    def evaluate_machine_coords(self, l: float) -&gt; tuple:\n        \"\"\"\u8bc4\u4f30\u673a\u5e8a\u5750\u6807 (XYZ, A, C)\"\"\"\n    \n    def evaluate_machine_coords_batch(self, l_values: np.ndarray) -&gt; tuple:\n        \"\"\"\u6279\u91cf\u8bc4\u4f30\u673a\u5e8a\u5750\u6807\"\"\"\n    \n    @property\n    def length(self) -&gt; float:\n        \"\"\"\u8f68\u8ff9\u603b\u5f27\u957f\"\"\"\n    \n    @property\n    def position_spline(self) -&gt; PositionSpline:\n        \"\"\"\u4f4d\u7f6e\u6837\u6761\u5bf9\u8c61\"\"\"\n    \n    @property\n    def orientation_spline(self) -&gt; OrientationSpline:\n        \"\"\"\u59ff\u6001\u6837\u6761\u5bf9\u8c61\"\"\"\n</pre>"},{"location":"notebooks/04_end_to_end_example/","title":"\u603b\u7ed3\u00b6","text":"<p>\u672c\u6587\u6863\u5c55\u793a\u4e86\u4ece\u79bb\u6563\u6570\u636e\u70b9\u5230\u673a\u5e8a\u4e94\u8f74\u8fd0\u52a8\u7684\u5b8c\u6574\u6d41\u7a0b\u3002<code>FiveAxisPath</code> \u7c7b\u5c01\u88c5\u4e86\u4f4d\u7f6e\u6837\u6761\u3001\u59ff\u6001\u6837\u6761\u548c\u9006\u8fd0\u52a8\u5b66\uff0c\u63d0\u4f9b\u7b80\u6d01\u7684 API\u3002C\u00b3 \u8fde\u7eed\u6027\u4fdd\u8bc1\u4e86 jerk \u7684\u5e73\u6ed1\u6027\uff0c\u76f8\u6bd4 C\u00b2 \u6837\u6761\u663e\u8457\u51cf\u5c11\u4e86\u673a\u5e8a\u632f\u52a8\u3002</p>"},{"location":"theory/ac_kinematics/","title":"A-C \u9006\u8fd0\u52a8\u5b66\u63a8\u5bfc (Eq.42)","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63a8\u5bfc A-C \u914d\u7f6e\u4e94\u8f74\u673a\u5e8a\u7684\u9006\u8fd0\u52a8\u5b66\u53d8\u6362\u3002</p>"},{"location":"theory/ac_kinematics/#1-a-c","title":"1. A-C \u914d\u7f6e\u673a\u5e8a\u51e0\u4f55","text":""},{"location":"theory/ac_kinematics/#11","title":"1.1 \u5750\u6807\u7cfb\u5b9a\u4e49","text":"<ul> <li>\u5de5\u4ef6\u5750\u6807\u7cfb (WCS)\uff1a\u56fa\u5b9a\u5728\u5de5\u4ef6\u4e0a\uff0c\u5200\u5c16\u4f4d\u7f6e \\(\\mathbf{P}\\) \u548c\u5200\u8f74\u59ff\u6001 \\(\\mathbf{O}\\) \u5728\u6b64\u5750\u6807\u7cfb\u4e0b\u5b9a\u4e49</li> <li>\u673a\u5e8a\u5750\u6807\u7cfb (MCS)\uff1a\u56fa\u5b9a\u5728\u673a\u5e8a\u4e0a\uff0c\u63a7\u5236\u5668\u6307\u4ee4 \\((X, Y, Z, A, C)\\) \u5728\u6b64\u5750\u6807\u7cfb\u4e0b</li> </ul>"},{"location":"theory/ac_kinematics/#12","title":"1.2 \u65cb\u8f6c\u8f74\u5e03\u5c40","text":"<p>A-C \u914d\u7f6e\u7684\u7279\u70b9\uff1a</p> <ul> <li>A \u8f74\uff1a\u7ed5 X \u8f74\u65cb\u8f6c\uff0c\u63a7\u5236\u5200\u5177\u503e\u659c\u89d2</li> <li>C \u8f74\uff1a\u7ed5 Z \u8f74\u65cb\u8f6c\uff0c\u63a7\u5236\u5de5\u4f5c\u53f0\u65cb\u8f6c</li> </ul> <pre><code>        Z (\u4e3b\u8f74\u65b9\u5411)\n        \u2191\n        \u2502    \u5200\u5177\n        \u2502   \u2571\n        \u2502  \u2571 A\u8f74\u65cb\u8f6c\n        \u2502 \u2571\n        \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Y\n       \u2571\n      \u2571\n     X\n    \u2199\n       \u2190 C\u8f74\u65cb\u8f6c (\u5de5\u4f5c\u53f0)\n</code></pre>"},{"location":"theory/ac_kinematics/#13","title":"1.3 \u504f\u79fb\u53c2\u6570","text":"<ul> <li>\\(L_{ac,z}\\)\uff1aA-C \u8f74\u4ea4\u70b9\u5230\u5de5\u4f5c\u53f0\u8868\u9762\u7684 Z \u65b9\u5411\u504f\u79fb</li> <li>\\(L_{Tya,z}\\)\uff1a\u5200\u5177\u957f\u5ea6\u8865\u507f\uff08\u5200\u5c16\u5230\u4e3b\u8f74\u53c2\u8003\u70b9\u7684\u8ddd\u79bb\uff09</li> </ul>"},{"location":"theory/ac_kinematics/#2-eq42","title":"2. \u65cb\u8f6c\u8f74\u89d2\u5ea6\u8ba1\u7b97 (Eq.42)","text":""},{"location":"theory/ac_kinematics/#21","title":"2.1 \u5200\u8f74\u59ff\u6001\u4e0e\u65cb\u8f6c\u8f74\u5173\u7cfb","text":"<p>\u5200\u8f74\u59ff\u6001 \\(\\mathbf{O} = (O_i, O_j, O_k)^T\\) \u662f\u5355\u4f4d\u5411\u91cf\uff0c\u8868\u793a\u5200\u5177\u8f74\u7ebf\u65b9\u5411\u3002</p> <p>\u5728 A-C \u914d\u7f6e\u4e0b\uff1a</p> <ul> <li>A \u89d2\u662f\u5200\u8f74\u4e0e Z \u8f74\u7684\u5939\u89d2</li> <li>C \u89d2\u662f\u5200\u8f74\u5728 XY \u5e73\u9762\u6295\u5f71\u4e0e Y \u8f74\u7684\u5939\u89d2</li> </ul>"},{"location":"theory/ac_kinematics/#22-eq42","title":"2.2 \u89d2\u5ea6\u8ba1\u7b97\u516c\u5f0f (Eq.42)","text":"\\[A = \\arccos(O_k) \\tag{Eq.42a}\\] \\[C = \\text{atan2}(O_i, O_j) \\tag{Eq.42b}\\]"},{"location":"theory/ac_kinematics/#23","title":"2.3 \u516c\u5f0f\u63a8\u5bfc","text":"<p>A \u89d2\u63a8\u5bfc\uff1a</p> <p>\u5200\u8f74\u4e0e Z \u8f74\u7684\u5939\u89d2\u6ee1\u8db3\uff1a</p> \\[\\cos(A) = \\mathbf{O} \\cdot \\mathbf{e}_z = O_k\\] <p>\u56e0\u6b64 \\(A = \\arccos(O_k)\\)\uff0c\u8303\u56f4 \\([0, \\pi]\\)\u3002</p> <p>C \u89d2\u63a8\u5bfc\uff1a</p> <p>\u5200\u8f74\u5728 XY \u5e73\u9762\u7684\u6295\u5f71\u4e3a \\((O_i, O_j)\\)\uff0c\u4e0e Y \u8f74\u6b63\u65b9\u5411\u7684\u5939\u89d2\uff1a</p> \\[C = \\text{atan2}(O_i, O_j)\\] <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u662f \\(\\text{atan2}(O_i, O_j)\\) \u800c\u975e \\(\\text{atan2}(O_j, O_i)\\)\uff0c\u56e0\u4e3a C \u8f74\u7ed5 Z \u8f74\u65cb\u8f6c\uff0c\u6b63\u65b9\u5411\u4ece Y \u8f74\u5230 X \u8f74\u3002</p>"},{"location":"theory/ac_kinematics/#3","title":"3. \u65cb\u8f6c\u77e9\u9635","text":""},{"location":"theory/ac_kinematics/#31-a","title":"3.1 A \u8f74\u65cb\u8f6c\u77e9\u9635","text":"<p>\u7ed5 X \u8f74\u65cb\u8f6c A \u89d2\uff1a</p> \\[R_A = \\begin{bmatrix} 1 &amp; 0 &amp; 0 \\\\ 0 &amp; \\cos A &amp; -\\sin A \\\\ 0 &amp; \\sin A &amp; \\cos A \\end{bmatrix}\\]"},{"location":"theory/ac_kinematics/#32-c","title":"3.2 C \u8f74\u65cb\u8f6c\u77e9\u9635","text":"<p>\u7ed5 Z \u8f74\u65cb\u8f6c C \u89d2\uff1a</p> \\[R_C = \\begin{bmatrix} \\cos C &amp; -\\sin C &amp; 0 \\\\ \\sin C &amp; \\cos C &amp; 0 \\\\ 0 &amp; 0 &amp; 1 \\end{bmatrix}\\]"},{"location":"theory/ac_kinematics/#33","title":"3.3 \u590d\u5408\u65cb\u8f6c","text":"<p>\u4ece\u5de5\u4ef6\u5750\u6807\u7cfb\u5230\u673a\u5e8a\u5750\u6807\u7cfb\u7684\u65cb\u8f6c\uff1a</p> \\[R = R_A \\cdot R_C\\] <p>\u9006\u53d8\u6362\uff08\u673a\u5e8a\u5230\u5de5\u4ef6\uff09\uff1a</p> \\[R^{-1} = R_C^{-1} \\cdot R_A^{-1} = R_C^T \\cdot R_A^T\\]"},{"location":"theory/ac_kinematics/#4","title":"4. \u7ebf\u6027\u8f74\u53d8\u6362","text":""},{"location":"theory/ac_kinematics/#41","title":"4.1 \u53d8\u6362\u516c\u5f0f","text":"<p>\u673a\u5e8a\u7ebf\u6027\u8f74\u4f4d\u7f6e\u7531\u4ee5\u4e0b\u516c\u5f0f\u8ba1\u7b97\uff1a</p> \\[\\mathbf{XYZ} = R^{-1} \\cdot (\\mathbf{P} + L_{Tya,z} \\cdot \\mathbf{O}) - \\begin{pmatrix} 0 \\\\ 0 \\\\ L_{ac,z} \\end{pmatrix}\\]"},{"location":"theory/ac_kinematics/#42","title":"4.2 \u516c\u5f0f\u89e3\u91ca","text":"<ol> <li>\\(\\mathbf{P} + L_{Tya,z} \\cdot \\mathbf{O}\\)\uff1a\u5200\u5c16\u4f4d\u7f6e\u52a0\u4e0a\u5200\u5177\u957f\u5ea6\u8865\u507f\uff0c\u5f97\u5230\u4e3b\u8f74\u53c2\u8003\u70b9\u4f4d\u7f6e</li> <li>\\(R^{-1} \\cdot (\\cdots)\\)\uff1a\u4ece\u5de5\u4ef6\u5750\u6807\u7cfb\u53d8\u6362\u5230\u65cb\u8f6c\u540e\u7684\u673a\u5e8a\u5750\u6807\u7cfb</li> <li>\u51cf\u53bb \\(L_{ac,z}\\)\uff1a\u8865\u507f A-C \u8f74\u4ea4\u70b9\u5230\u5de5\u4f5c\u53f0\u7684\u504f\u79fb</li> </ol>"},{"location":"theory/ac_kinematics/#43","title":"4.3 \u5c55\u5f00\u5f62\u5f0f","text":"\\[X = (\\cos C)(P_x + L_{Tya,z} O_i) + (\\sin C)(P_y + L_{Tya,z} O_j)\\] \\[Y = (-\\sin C \\cos A)(P_x + L_{Tya,z} O_i) + (\\cos C \\cos A)(P_y + L_{Tya,z} O_j) + (\\sin A)(P_z + L_{Tya,z} O_k)\\] \\[Z = (\\sin C \\sin A)(P_x + L_{Tya,z} O_i) + (-\\cos C \\sin A)(P_y + L_{Tya,z} O_j) + (\\cos A)(P_z + L_{Tya,z} O_k) - L_{ac,z}\\]"},{"location":"theory/ac_kinematics/#5","title":"5. \u5947\u5f02\u6027\u5206\u6790","text":""},{"location":"theory/ac_kinematics/#51","title":"5.1 \u5947\u5f02\u70b9\u6761\u4ef6","text":"<p>\u5f53 \\(A = 0\\)\uff08\u5200\u8f74\u4e0e Z \u8f74\u5e73\u884c\uff09\u65f6\uff1a - \\(O_i = O_j = 0\\), \\(O_k = 1\\) - \\(C = \\text{atan2}(0, 0)\\) \u672a\u5b9a\u4e49</p>"},{"location":"theory/ac_kinematics/#52","title":"5.2 \u5947\u5f02\u70b9\u5904\u7406","text":"<p>\u5b9e\u9645\u5e94\u7528\u4e2d\u7684\u5904\u7406\u65b9\u6cd5\uff1a 1. \u4fdd\u6301 C \u4e0d\u53d8\uff1a\u4f7f\u7528\u4e0a\u4e00\u65f6\u523b\u7684 C \u503c 2. \u5c0f\u89d2\u5ea6\u8fd1\u4f3c\uff1a\u5f53 \\(A &lt; \\epsilon\\) \u65f6\uff0c\\(C\\) \u8bbe\u4e3a 0 \u6216\u4fdd\u6301\u4e0d\u53d8 3. \u8f68\u8ff9\u89c4\u5212\u907f\u5f00\uff1a\u5728\u8f68\u8ff9\u89c4\u5212\u9636\u6bb5\u907f\u5f00\u5947\u5f02\u914d\u7f6e</p> <pre><code>def handle_singularity(A, C, A_prev, C_prev, threshold=1e-6):\n    \"\"\"\u5904\u7406\u5947\u5f02\u70b9\"\"\"\n    if A &lt; threshold:\n        return A, C_prev  # \u4fdd\u6301 C \u4e0d\u53d8\n    return A, C\n</code></pre>"},{"location":"theory/ac_kinematics/#6","title":"6. \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>def inverse_kinematics_ac(P, O, L_ac_z=0, L_Tya_z=0):\n    \"\"\"A-C \u914d\u7f6e\u9006\u8fd0\u52a8\u5b66 (Eq.42)\"\"\"\n    # \u65cb\u8f6c\u8f74\u89d2\u5ea6\n    A = np.arccos(np.clip(O[2], -1, 1))\n    C = np.arctan2(O[0], O[1])\n\n    # \u65cb\u8f6c\u77e9\u9635\n    cos_A, sin_A = np.cos(A), np.sin(A)\n    cos_C, sin_C = np.cos(C), np.sin(C)\n\n    R_A_inv = np.array([\n        [1, 0, 0],\n        [0, cos_A, sin_A],\n        [0, -sin_A, cos_A]\n    ])\n    R_C_inv = np.array([\n        [cos_C, sin_C, 0],\n        [-sin_C, cos_C, 0],\n        [0, 0, 1]\n    ])\n    R_inv = R_C_inv @ R_A_inv\n\n    # \u5200\u5177\u8865\u507f\n    P_comp = P + L_Tya_z * O\n\n    # \u7ebf\u6027\u8f74\u4f4d\u7f6e\n    XYZ = R_inv @ P_comp - np.array([0, 0, L_ac_z])\n\n    return XYZ, A, C\n\ndef batch_inverse_kinematics_ac(positions, orientations, L_ac_z=0, L_Tya_z=0):\n    \"\"\"\u6279\u91cf\u9006\u8fd0\u52a8\u5b66\"\"\"\n    N = len(positions)\n    XYZ = np.zeros((N, 3))\n    A = np.zeros(N)\n    C = np.zeros(N)\n\n    for i in range(N):\n        XYZ[i], A[i], C[i] = inverse_kinematics_ac(\n            positions[i], orientations[i], L_ac_z, L_Tya_z\n        )\n\n    return XYZ, A, C\n</code></pre>"},{"location":"theory/ac_kinematics/#7","title":"7. \u9a8c\u8bc1","text":""},{"location":"theory/ac_kinematics/#71","title":"7.1 \u5355\u4f4d\u5411\u91cf\u68c0\u9a8c","text":"\\[O_i^2 + O_j^2 + O_k^2 = \\sin^2 A \\cos^2 C + \\sin^2 A \\sin^2 C + \\cos^2 A = 1 \\checkmark\\]"},{"location":"theory/ac_kinematics/#72","title":"7.2 \u9006\u53d8\u6362\u9a8c\u8bc1","text":"<p>\u4ece \\((A, C)\\) \u6062\u590d\u59ff\u6001\u5411\u91cf\uff1a</p> \\[\\mathbf{O} = \\begin{pmatrix} \\sin A \\sin C \\\\ \\sin A \\cos C \\\\ \\cos A \\end{pmatrix}\\] <p>\u5e94\u4e0e\u539f\u59cb\u59ff\u6001\u4e00\u81f4\u3002</p>"},{"location":"theory/ac_kinematics/#_1","title":"\u603b\u7ed3","text":"<p>A-C \u914d\u7f6e\u9006\u8fd0\u52a8\u5b66\u5c06\u5de5\u4ef6\u5750\u6807\u7cfb\u4e0b\u7684\u5200\u5c16\u4f4d\u7f6e\u548c\u5200\u8f74\u59ff\u6001\u8f6c\u6362\u4e3a\u673a\u5e8a\u7684\u4e94\u8f74\u8fd0\u52a8\u6307\u4ee4\u3002\u65cb\u8f6c\u8f74\u89d2\u5ea6\u76f4\u63a5\u7531\u59ff\u6001\u5411\u91cf\u7684\u7403\u5750\u6807\u5206\u91cf\u8ba1\u7b97\uff0c\u7ebf\u6027\u8f74\u4f4d\u7f6e\u9700\u8003\u8651\u65cb\u8f6c\u53d8\u6362\u548c\u5200\u5177\u504f\u79fb\u8865\u507f\u3002\u9700\u6ce8\u610f \\(A = 0\\) \u5904\u7684\u5947\u5f02\u6027\u95ee\u9898\u3002</p>"},{"location":"theory/arc_length_parameterization/","title":"\u5f27\u957f\u53c2\u6570\u5316\u63a8\u5bfc (Eq.8-10)","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63a8\u5bfc\u5f27\u957f\u8ba1\u7b97\u548c\u81ea\u9002\u5e94 Simpson \u79ef\u5206\u7684\u6570\u5b66\u539f\u7406\u3002</p>"},{"location":"theory/arc_length_parameterization/#1-eq8","title":"1. \u5f27\u957f\u79ef\u5206\u5b9a\u4e49 (Eq.8)","text":"<p>\u7ed9\u5b9a\u53c2\u6570\u66f2\u7ebf \\(\\mathbf{P}(u)\\)\uff0c\u4ece\u53c2\u6570 \\(0\\) \u5230 \\(u\\) \u7684\u5f27\u957f\u5b9a\u4e49\u4e3a\uff1a</p> \\[s(u) = \\int_0^u \\|\\mathbf{P}'(\\tau)\\| d\\tau \\tag{Eq.8}\\] <p>\u5176\u4e2d \\(\\mathbf{P}'(u) = \\frac{d\\mathbf{P}}{du}\\) \u662f\u66f2\u7ebf\u7684\u5207\u5411\u91cf\u3002</p>"},{"location":"theory/arc_length_parameterization/#11","title":"1.1 \u88ab\u79ef\u51fd\u6570","text":"<p>\u5f27\u957f\u5fae\u5206 \\(ds = \\|\\mathbf{P}'(u)\\| du\\)\uff0c\u88ab\u79ef\u51fd\u6570\u4e3a\uff1a</p> \\[f(u) = \\|\\mathbf{P}'(u)\\| = \\sqrt{P_x'(u)^2 + P_y'(u)^2 + P_z'(u)^2}\\] <p>\u5bf9\u4e8e\u4e94\u6b21 B \u6837\u6761\uff0c\\(\\mathbf{P}'(u)\\) \u662f\u56db\u6b21\u591a\u9879\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u6837\u6761\u5bfc\u6570\u76f4\u63a5\u8ba1\u7b97\u3002</p>"},{"location":"theory/arc_length_parameterization/#2-simpson-eq9-10","title":"2. \u81ea\u9002\u5e94 Simpson \u79ef\u5206 (Eq.9-10)","text":""},{"location":"theory/arc_length_parameterization/#21-simpson","title":"2.1 Simpson \u6cd5\u5219","text":"<p>Simpson \u6cd5\u5219\u4f7f\u7528\u629b\u7269\u7ebf\u8fd1\u4f3c\u88ab\u79ef\u51fd\u6570\uff1a</p> \\[\\int_a^b f(x) dx \\approx \\frac{b-a}{6} \\left[ f(a) + 4f\\left(\\frac{a+b}{2}\\right) + f(b) \\right]\\]"},{"location":"theory/arc_length_parameterization/#22","title":"2.2 \u81ea\u9002\u5e94\u7ec6\u5206\u7b56\u7565","text":"<p>\u81ea\u9002\u5e94 Simpson \u79ef\u5206\u901a\u8fc7\u9012\u5f52\u7ec6\u5206\u63d0\u9ad8\u7cbe\u5ea6 (Eq.9-10)\uff1a</p> <ol> <li>\u8ba1\u7b97\u6574\u4e2a\u533a\u95f4\u7684 Simpson \u8fd1\u4f3c \\(S_1\\)</li> <li>\u5c06\u533a\u95f4\u4e8c\u5206\uff0c\u8ba1\u7b97\u4e24\u4e2a\u5b50\u533a\u95f4\u7684 Simpson \u8fd1\u4f3c\u4e4b\u548c \\(S_2\\)</li> <li>\u4f30\u8ba1\u8bef\u5dee \\(E = |S_2 - S_1| / 15\\)</li> <li>\u5982\u679c \\(E &lt; \\epsilon\\)\uff0c\u63a5\u53d7 \\(S_2\\)\uff1b\u5426\u5219\u9012\u5f52\u7ec6\u5206</li> </ol> <pre><code>adaptive_simpson(f, a, b, \u03b5):\n    c = (a + b) / 2\n    S_whole = simpson(f, a, b)\n    S_left = simpson(f, a, c)\n    S_right = simpson(f, c, b)\n    S_sum = S_left + S_right\n\n    if |S_sum - S_whole| / 15 &lt; \u03b5:\n        return S_sum\n    else:\n        return adaptive_simpson(f, a, c, \u03b5/2) + adaptive_simpson(f, c, b, \u03b5/2)\n</code></pre>"},{"location":"theory/arc_length_parameterization/#23","title":"2.3 \u8bef\u5dee\u4f30\u8ba1","text":"<p>Richardson \u5916\u63a8\u7ed9\u51fa\u8bef\u5dee\u4f30\u8ba1\uff1a</p> \\[E \\approx \\frac{|S_2 - S_1|}{15}\\] <p>\u8fd9\u662f\u56e0\u4e3a Simpson \u6cd5\u5219\u7684\u8bef\u5dee\u9636\u4e3a \\(O(h^5)\\)\uff0c\u4e8c\u5206\u540e\u8bef\u5dee\u51cf\u5c11\u4e3a \\(1/32\\)\u3002</p>"},{"location":"theory/arc_length_parameterization/#3","title":"3. \u5f27\u957f\u8868\u6784\u5efa","text":""},{"location":"theory/arc_length_parameterization/#31","title":"3.1 \u76ee\u7684","text":"<p>\u5f27\u957f\u8868\u5b58\u50a8 \\((u_i, s_i)\\) \u5bf9\uff0c\u7528\u4e8e\u540e\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u6620\u5c04\u3002</p>"},{"location":"theory/arc_length_parameterization/#32","title":"3.2 \u6784\u5efa\u8fc7\u7a0b","text":"<p>\u5728\u81ea\u9002\u5e94\u79ef\u5206\u8fc7\u7a0b\u4e2d\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u7ec6\u5206\u533a\u95f4\u7684\u7aef\u70b9\u548c\u5f27\u957f\uff1a</p> <pre><code>def compute_arc_length_table(spline, tol=1e-9):\n    \"\"\"\u8ba1\u7b97\u5f27\u957f\u8868\"\"\"\n    spline_deriv = spline.derivative()\n\n    def integrand(u):\n        return np.linalg.norm(spline_deriv(u))\n\n    intervals = []  # \u5b58\u50a8 (u_start, u_end, length)\n    total_length = adaptive_simpson(integrand, 0, 1, tol, intervals)\n\n    # \u6784\u5efa\u7d2f\u79ef\u5f27\u957f\u8868\n    u_values = [0.0]\n    arc_lengths = [0.0]\n    cumulative = 0.0\n\n    for _, u_end, length in intervals:\n        cumulative += length\n        u_values.append(u_end)\n        arc_lengths.append(cumulative)\n\n    return np.array(u_values), np.array(arc_lengths), total_length\n</code></pre>"},{"location":"theory/arc_length_parameterization/#33","title":"3.3 \u8868\u7684\u6027\u8d28","text":"<ul> <li>\\(u_0 = 0\\), \\(s_0 = 0\\)</li> <li>\\(u_n = 1\\), \\(s_n = S\\)\uff08\u603b\u5f27\u957f\uff09</li> <li>\\((u_i, s_i)\\) \u5355\u8c03\u9012\u589e</li> <li>\u533a\u95f4\u5206\u5e03\u81ea\u9002\u5e94\u4e8e\u66f2\u7387\u53d8\u5316</li> </ul>"},{"location":"theory/arc_length_parameterization/#4","title":"4. \u5f27\u957f\u67e5\u627e","text":"<p>\u7ed9\u5b9a\u5f27\u957f \\(l\\)\uff0c\u9700\u8981\u627e\u5230\u5bf9\u5e94\u7684\u53c2\u6570 \\(u\\)\uff0c\u4f7f\u5f97 \\(s(u) = l\\)\u3002</p>"},{"location":"theory/arc_length_parameterization/#41","title":"4.1 \u4e8c\u5206\u67e5\u627e","text":"<ol> <li>\u5728\u5f27\u957f\u8868\u4e2d\u627e\u5230 \\(s_{i-1} \\leq l &lt; s_i\\) \u7684\u533a\u95f4</li> <li>\u5728\u533a\u95f4 \\([u_{i-1}, u_i]\\) \u5185\u4f7f\u7528\u725b\u987f\u6cd5\u6216\u4e8c\u5206\u6cd5\u7cbe\u786e\u6c42\u89e3</li> </ol>"},{"location":"theory/arc_length_parameterization/#42","title":"4.2 \u4e3a\u4ec0\u4e48\u9700\u8981\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f","text":"<p>\u76f4\u63a5\u67e5\u8868 + \u63d2\u503c\u7684\u65b9\u6cd5\uff1a - \u53ea\u80fd\u8fbe\u5230 C\u2070 \u6216 C\u00b9 \u8fde\u7eed - \u65e0\u6cd5\u4fdd\u8bc1 C\u00b3 \u8fde\u7eed\u6027</p> <p>\u56e0\u6b64\u9700\u8981 9 \u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u6765\u5b9e\u73b0 C\u00b3 \u8fde\u7eed\u7684 \\(u(l)\\) \u6620\u5c04\u3002</p>"},{"location":"theory/arc_length_parameterization/#5","title":"5. \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>def adaptive_simpson(f, a, b, tol, intervals=None):\n    \"\"\"\u81ea\u9002\u5e94 Simpson \u79ef\u5206\"\"\"\n    c = (a + b) / 2\n    h = b - a\n\n    fa, fc, fb = f(a), f(c), f(b)\n    S_whole = h / 6 * (fa + 4*fc + fb)\n\n    d = (a + c) / 2\n    e = (c + b) / 2\n    fd, fe = f(d), f(e)\n\n    S_left = (c - a) / 6 * (fa + 4*fd + fc)\n    S_right = (b - c) / 6 * (fc + 4*fe + fb)\n    S_sum = S_left + S_right\n\n    error = abs(S_sum - S_whole) / 15\n\n    if error &lt; tol:\n        if intervals is not None:\n            intervals.append((a, b, S_sum))\n        return S_sum\n    else:\n        left = adaptive_simpson(f, a, c, tol/2, intervals)\n        right = adaptive_simpson(f, c, b, tol/2, intervals)\n        return left + right\n</code></pre>"},{"location":"theory/arc_length_parameterization/#_1","title":"\u603b\u7ed3","text":"<p>\u5f27\u957f\u8ba1\u7b97\u901a\u8fc7\u81ea\u9002\u5e94 Simpson \u79ef\u5206\u5b9e\u73b0\u9ad8\u7cbe\u5ea6\u6570\u503c\u79ef\u5206\u3002\u79ef\u5206\u8fc7\u7a0b\u4e2d\u6784\u5efa\u7684\u5f27\u957f\u8868\u4e3a\u540e\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u63d0\u4f9b\u57fa\u7840\u6570\u636e\u3002\u7136\u800c\uff0c\u76f4\u63a5\u4f7f\u7528\u5f27\u957f\u8868\u65e0\u6cd5\u4fdd\u8bc1 C\u00b3 \u8fde\u7eed\u6027\uff0c\u9700\u8981\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u6765\u5b9e\u73b0\u5e73\u6ed1\u6620\u5c04\u3002</p>"},{"location":"theory/bezier_reparameterization/","title":"B\u00e9zier \u91cd\u53c2\u6570\u5316\u63a8\u5bfc (Eq.32-41)","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63a8\u5bfc 7 \u9636 B\u00e9zier \u91cd\u53c2\u6570\u5316\u7684\u6570\u5b66\u539f\u7406\uff0c\u7528\u4e8e\u5b9e\u73b0 C\u00b3 \u8fde\u7eed\u7684\u5f27\u957f\u53c2\u6570\u5316\u59ff\u6001\u6837\u6761\u3002</p>"},{"location":"theory/bezier_reparameterization/#1","title":"1. \u95ee\u9898\u5b9a\u4e49","text":""},{"location":"theory/bezier_reparameterization/#11","title":"1.1 \u76ee\u6807","text":"<p>\u6784\u5efa\u6620\u5c04 \\(w(l)\\)\uff0c\u5c06\u5f27\u957f \\(l\\) \u6620\u5c04\u5230\u59ff\u6001\u6837\u6761\u53c2\u6570 \\(w\\)\uff0c\u6ee1\u8db3\uff1a</p> <ul> <li>C\u00b3 \u8fde\u7eed\u6027</li> <li>\u5355\u8c03\u6027\uff08\\(w\\) \u968f \\(l\\) \u5355\u8c03\u9012\u589e\uff09</li> <li>\u7aef\u70b9\u63d2\u503c</li> </ul>"},{"location":"theory/bezier_reparameterization/#12-bezier","title":"1.2 \u4e3a\u4ec0\u4e48\u7528 B\u00e9zier \u800c\u975e\u591a\u9879\u5f0f","text":"<p>\u4e0e\u4f4d\u7f6e\u6837\u6761\u7684 9 \u9636\u591a\u9879\u5f0f\u4e0d\u540c\uff0c\u59ff\u6001\u91cd\u53c2\u6570\u5316\u4f7f\u7528 7 \u9636 B\u00e9zier \u66f2\u7ebf\uff0c\u539f\u56e0\uff1a</p> <ul> <li>B\u00e9zier \u66f2\u7ebf\u5929\u7136\u652f\u6301\u5206\u6bb5\u8868\u793a</li> <li>\u63a7\u5236\u70b9\u76f4\u89c2\uff0c\u4fbf\u4e8e\u65bd\u52a0\u5355\u8c03\u6027\u7ea6\u675f</li> <li>\u51f8\u5305\u6027\u8d28\u6709\u5229\u4e8e\u4f18\u5316</li> </ul>"},{"location":"theory/bezier_reparameterization/#2-7-bernstein-eq32-33","title":"2. 7 \u9636 Bernstein \u591a\u9879\u5f0f (Eq.32-33)","text":""},{"location":"theory/bezier_reparameterization/#21-bernstein","title":"2.1 Bernstein \u57fa\u51fd\u6570","text":"<p>7 \u9636 Bernstein \u57fa\u51fd\u6570\u5b9a\u4e49\u4e3a\uff1a</p> \\[B_{i,7}(r) = \\binom{7}{i} (1-r)^{7-i} r^i, \\quad i = 0, 1, \\ldots, 7 \\tag{Eq.32}\\] <p>\u5176\u4e2d \\(r \\in [0, 1]\\) \u662f\u533a\u95f4\u5185\u7684\u5f52\u4e00\u5316\u53c2\u6570\u3002</p>"},{"location":"theory/bezier_reparameterization/#22-bezier","title":"2.2 B\u00e9zier \u66f2\u7ebf\u5f62\u5f0f","text":"<p>\u6bcf\u6bb5 \\([l_k, l_{k+1}]\\) \u4e0a\u7684\u91cd\u53c2\u6570\u5316\u51fd\u6570\u4e3a\uff1a</p> \\[w(r) = \\sum_{i=0}^{7} B_{i,7}(r) Q_{i,k} \\tag{Eq.33}\\] <p>\u5176\u4e2d \\(Q_{i,k}\\) \u662f\u7b2c \\(k\\) \u6bb5\u7684\u63a7\u5236\u7cfb\u6570\u3002</p>"},{"location":"theory/bezier_reparameterization/#23","title":"2.3 \u5c40\u90e8\u53c2\u6570","text":"<p>\u5f52\u4e00\u5316\u53c2\u6570 \\(r\\) \u4e0e\u5f27\u957f \\(l\\) \u7684\u5173\u7cfb\uff1a</p> \\[r = \\frac{l - l_k}{l_{k+1} - l_k}\\]"},{"location":"theory/bezier_reparameterization/#3-eq37","title":"3. \u7aef\u70b9\u7ea6\u675f (Eq.37)","text":""},{"location":"theory/bezier_reparameterization/#31","title":"3.1 \u503c\u7ea6\u675f","text":"<p>B\u00e9zier \u66f2\u7ebf\u7aef\u70b9\u7b49\u4e8e\u9996\u5c3e\u63a7\u5236\u70b9\uff1a</p> \\[w(0) = Q_{0,k} = w_k \\tag{Eq.37a}\\] \\[w(1) = Q_{7,k} = w_{k+1} \\tag{Eq.37b}\\]"},{"location":"theory/bezier_reparameterization/#32","title":"3.2 \u81ea\u7531\u53d8\u91cf","text":"<p>\u6bcf\u6bb5\u6709 8 \u4e2a\u63a7\u5236\u70b9\uff0c\u7aef\u70b9\u56fa\u5b9a\u540e\u5269\u4f59 6 \u4e2a\u81ea\u7531\u53d8\u91cf\uff1a\\(Q_1, Q_2, \\ldots, Q_6\\)\u3002</p>"},{"location":"theory/bezier_reparameterization/#4-eq36","title":"4. \u5355\u8c03\u6027\u7ea6\u675f (Eq.36)","text":""},{"location":"theory/bezier_reparameterization/#41-bezier","title":"4.1 B\u00e9zier \u66f2\u7ebf\u5355\u8c03\u6027\u6761\u4ef6","text":"<p>\u82e5\u63a7\u5236\u70b9\u5355\u8c03\u9012\u589e\uff0c\u5219 B\u00e9zier \u66f2\u7ebf\u5355\u8c03\uff1a</p> \\[Q_{0,k} \\leq Q_{1,k} \\leq Q_{2,k} \\leq \\cdots \\leq Q_{7,k} \\tag{Eq.36}\\]"},{"location":"theory/bezier_reparameterization/#42","title":"4.2 \u7ea6\u675f\u5f62\u5f0f","text":"<p>\u5bf9\u4e8e\u4f18\u5316\u95ee\u9898\uff0c\u5355\u8c03\u6027\u7ea6\u675f\u8868\u793a\u4e3a\u4e0d\u7b49\u5f0f\u7ea6\u675f\uff1a</p> \\[Q_{i+1,k} - Q_{i,k} \\geq 0, \\quad i = 0, 1, \\ldots, 6\\]"},{"location":"theory/bezier_reparameterization/#5-c3-eq38","title":"5. C\u00b3 \u8fde\u7eed\u6027\u7ea6\u675f (Eq.38)","text":""},{"location":"theory/bezier_reparameterization/#51","title":"5.1 \u5bfc\u6570\u4e0e\u63a7\u5236\u70b9\u5dee\u5206\u7684\u5173\u7cfb","text":"<p>B\u00e9zier \u66f2\u7ebf\u5728\u7aef\u70b9\u7684\u5bfc\u6570\uff1a</p> \\[w'(0) = 7 \\cdot \\frac{Q_1 - Q_0}{\\Delta l}\\] \\[w''(0) = 42 \\cdot \\frac{Q_2 - 2Q_1 + Q_0}{\\Delta l^2}\\] \\[w'''(0) = 210 \\cdot \\frac{Q_3 - 3Q_2 + 3Q_1 - Q_0}{\\Delta l^3}\\] <p>\u53f3\u7aef\u70b9\u7c7b\u4f3c\u3002</p>"},{"location":"theory/bezier_reparameterization/#52-eq38","title":"5.2 \u6bb5\u95f4\u8fde\u7eed\u6027 (Eq.38)","text":"<p>\u7b2c \\(k\\) \u6bb5\u672b\u5c3e\u4e0e\u7b2c \\(k+1\\) \u6bb5\u5f00\u5934\u7684\u5bfc\u6570\u5fc5\u987b\u76f8\u7b49\uff1a</p> <p>C\u00b9 \u8fde\u7eed\uff1a $\\(\\frac{Q_{7,k} - Q_{6,k}}{\\Delta l_k} = \\frac{Q_{1,k+1} - Q_{0,k+1}}{\\Delta l_{k+1}} \\tag{Eq.38a}\\)$</p> <p>C\u00b2 \u8fde\u7eed\uff1a $\\(\\frac{Q_{7,k} - 2Q_{6,k} + Q_{5,k}}{\\Delta l_k^2} = \\frac{Q_{2,k+1} - 2Q_{1,k+1} + Q_{0,k+1}}{\\Delta l_{k+1}^2} \\tag{Eq.38b}\\)$</p> <p>C\u00b3 \u8fde\u7eed\uff1a $\\(\\frac{Q_{7,k} - 3Q_{6,k} + 3Q_{5,k} - Q_{4,k}}{\\Delta l_k^3} = \\frac{Q_{3,k+1} - 3Q_{2,k+1} + 3Q_{1,k+1} - Q_{0,k+1}}{\\Delta l_{k+1}^3} \\tag{Eq.38c}\\)$</p>"},{"location":"theory/bezier_reparameterization/#6-jerk-eq39","title":"6. Jerk \u6700\u5c0f\u5316\u76ee\u6807 (Eq.39)","text":""},{"location":"theory/bezier_reparameterization/#61","title":"6.1 \u76ee\u6807\u51fd\u6570","text":"<p>\u6700\u5c0f\u5316 jerk \u79ef\u5206\uff1a</p> \\[\\min \\int_0^L |w'''(l)|^2 dl \\tag{Eq.39}\\]"},{"location":"theory/bezier_reparameterization/#62","title":"6.2 \u79bb\u6563\u8fd1\u4f3c","text":"<p>\u4f7f\u7528\u63a7\u5236\u70b9\u4e09\u9636\u5dee\u5206\u4f5c\u4e3a jerk \u7684\u4ee3\u7406\uff1a</p> \\[J \\approx \\sum_k \\sum_{i=0}^{4} \\left( \\frac{Q_{i+3,k} - 3Q_{i+2,k} + 3Q_{i+1,k} - Q_{i,k}}{\\Delta l_k^3} \\right)^2\\]"},{"location":"theory/bezier_reparameterization/#7-eq40-41","title":"7. \u4f18\u5316\u6c42\u89e3 (Eq.40-41)","text":""},{"location":"theory/bezier_reparameterization/#71-eq41","title":"7.1 \u521d\u59cb\u503c\u8bbe\u5b9a (Eq.41)","text":"<p>\u4e3a\u4fdd\u8bc1\u5355\u8c03\u6027\uff0c\u521d\u59cb\u5316\u4f7f\u7528\u5747\u5300\u5206\u5e03\uff1a</p> \\[\\delta = \\min_k \\frac{w_{k+1} - w_k}{7 \\cdot \\Delta l_k}\\] \\[Q_{i,k} = w_k + i \\cdot \\delta \\cdot \\Delta l_k, \\quad i = 1, \\ldots, 6 \\tag{Eq.41}\\]"},{"location":"theory/bezier_reparameterization/#72-eq40","title":"7.2 \u4f18\u5316\u95ee\u9898 (Eq.40)","text":"\\[ \\begin{aligned} \\min_{\\{Q_{i,k}\\}} &amp;\\quad J(\\{Q_{i,k}\\})\\\\ \\text{s.t.} &amp;\\quad \\text{\u5355\u8c03\u6027\u7ea6\u675f (Eq.36)}\\\\ &amp;\\quad \\text{C\u00b3 \u8fde\u7eed\u6027\u7ea6\u675f (Eq.38)} \\end{aligned} \\]"},{"location":"theory/bezier_reparameterization/#73-slsqp","title":"7.3 SLSQP \u6c42\u89e3","text":"<p>\u4f7f\u7528 Sequential Least Squares Programming \u6c42\u89e3\uff1a</p> <pre><code>from scipy.optimize import minimize\n\nresult = minimize(\n    objective,           # Jerk \u79ef\u5206\n    x0,                  # \u521d\u59cb\u63a7\u5236\u70b9\n    method='SLSQP',\n    constraints=[\n        {'type': 'ineq', 'fun': monotonicity_constraint},\n        {'type': 'eq', 'fun': c1_constraint},\n        {'type': 'eq', 'fun': c2_constraint},\n        {'type': 'eq', 'fun': c3_constraint},\n    ],\n    options={'maxiter': 100}\n)\n</code></pre>"},{"location":"theory/bezier_reparameterization/#8","title":"8. \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>class BezierReparameterization:\n    def __init__(self, l_values, w_values):\n        self.l_values = l_values\n        self.w_values = w_values\n        self.Q = []  # \u6bcf\u6bb5\u7684\u63a7\u5236\u7cfb\u6570\n\n        self._initialize_coefficients()\n        self._optimize()\n\n    def _initialize_coefficients(self):\n        \"\"\"\u521d\u59cb\u5316\u63a7\u5236\u7cfb\u6570 (Eq.41)\"\"\"\n        l, w = self.l_values, self.w_values\n\n        # \u8ba1\u7b97\u5168\u5c40 \u03b4\n        deltas = [(w[k+1] - w[k]) / (7 * (l[k+1] - l[k]))\n                  for k in range(len(l) - 1)\n                  if l[k+1] - l[k] &gt; 1e-12]\n        delta = min(deltas) if deltas else 1e-6\n\n        # \u521d\u59cb\u5316\u6bcf\u6bb5\n        for k in range(len(l) - 1):\n            dl = l[k+1] - l[k]\n            Q = np.zeros(8)\n            Q[0] = w[k]\n            Q[7] = w[k+1]\n            for i in range(1, 7):\n                Q[i] = w[k] + i * delta * dl\n            self.Q.append(Q)\n\n    def __call__(self, l):\n        \"\"\"\u8bc4\u4f30 w(l)\"\"\"\n        l = np.clip(l, self.l_values[0], self.l_values[-1])\n\n        for k in range(len(self.Q)):\n            if self.l_values[k] &lt;= l &lt;= self.l_values[k+1]:\n                dl = self.l_values[k+1] - self.l_values[k]\n                r = (l - self.l_values[k]) / dl\n\n                # Bernstein \u591a\u9879\u5f0f\n                Q = self.Q[k]\n                w = sum(comb(7, i) * (1-r)**(7-i) * r**i * Q[i]\n                        for i in range(8))\n                return w\n\n        return self.w_values[-1]\n</code></pre>"},{"location":"theory/bezier_reparameterization/#9","title":"9. \u7b97\u6cd5\u7279\u70b9","text":"\u7279\u6027 \u8bf4\u660e \u8fde\u7eed\u6027 C\u00b3 \u8fde\u7eed\uff0cjerk \u5e73\u6ed1 \u5355\u8c03\u6027 \u63a7\u5236\u70b9\u7ea6\u675f\u4fdd\u8bc1 \u7075\u6d3b\u6027 \u5206\u6bb5\u8868\u793a\uff0c\u81ea\u9002\u5e94\u7cbe\u5ea6 \u9c81\u68d2\u6027 \u51f8\u4f18\u5316\uff0c\u6536\u655b\u7a33\u5b9a"},{"location":"theory/bezier_reparameterization/#_1","title":"\u603b\u7ed3","text":"<p>7 \u9636 B\u00e9zier \u91cd\u53c2\u6570\u5316\u901a\u8fc7\u63a7\u5236\u70b9\u4f18\u5316\uff0c\u5728\u6ee1\u8db3 C\u00b3 \u8fde\u7eed\u6027\u548c\u5355\u8c03\u6027\u7ea6\u675f\u7684\u524d\u63d0\u4e0b\u6700\u5c0f\u5316 jerk\u3002\u4e0e\u4f4d\u7f6e\u6837\u6761\u7684 9 \u9636\u591a\u9879\u5f0f\u4e0d\u540c\uff0cB\u00e9zier \u5f62\u5f0f\u66f4\u9002\u5408\u5206\u6bb5\u4f18\u5316\u548c\u7ea6\u675f\u5904\u7406\u3002\u8fd9\u662f\u5b9e\u73b0\u59ff\u6001\u6837\u6761\u5f27\u957f\u53c2\u6570\u5316\u7684\u5173\u952e\u6280\u672f\u3002</p>"},{"location":"theory/bspline_interpolation/","title":"B\u6837\u6761\u63d2\u503c\u6570\u5b66\u63a8\u5bfc (Eq.1-7)","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63a8\u5bfc\u4e94\u6b21 B \u6837\u6761\u63d2\u503c\u7684\u6570\u5b66\u539f\u7406\u3002</p>"},{"location":"theory/bspline_interpolation/#1-b","title":"1. B\u6837\u6761\u57fa\u7840","text":""},{"location":"theory/bspline_interpolation/#11","title":"1.1 \u57fa\u51fd\u6570\u9012\u5f52\u5b9a\u4e49","text":"<p>\\(p\\) \u6b21 B \u6837\u6761\u57fa\u51fd\u6570 \\(N_{i,p}(u)\\) \u7531 Cox-de Boor \u9012\u5f52\u516c\u5f0f\u5b9a\u4e49\uff1a</p> \\[N_{i,0}(u) = \\begin{cases} 1 &amp; u_i \\leq u &lt; u_{i+1} \\\\ 0 &amp; \\text{otherwise} \\end{cases}\\] \\[N_{i,p}(u) = \\frac{u - u_i}{u_{i+p} - u_i} N_{i,p-1}(u) + \\frac{u_{i+p+1} - u}{u_{i+p+1} - u_{i+1}} N_{i+1,p-1}(u)\\] <p>\u5176\u4e2d \\(\\{u_i\\}\\) \u662f\u8282\u70b9\u5411\u91cf\u3002</p>"},{"location":"theory/bspline_interpolation/#12-b","title":"1.2 B\u6837\u6761\u66f2\u7ebf","text":"<p>\u7ed9\u5b9a \\(n+1\\) \u4e2a\u63a7\u5236\u70b9 \\(\\{\\mathbf{Q}_0, \\mathbf{Q}_1, \\ldots, \\mathbf{Q}_n\\}\\)\uff0c\\(p\\) \u6b21 B \u6837\u6761\u66f2\u7ebf\u5b9a\u4e49\u4e3a\uff1a</p> \\[\\mathbf{P}(u) = \\sum_{i=0}^{n} N_{i,p}(u) \\mathbf{Q}_i\\]"},{"location":"theory/bspline_interpolation/#2-b-eq1-3","title":"2. \u4e94\u6b21 B \u6837\u6761\u63d2\u503c (Eq.1-3)","text":""},{"location":"theory/bspline_interpolation/#21","title":"2.1 \u63d2\u503c\u95ee\u9898","text":"<p>\u7ed9\u5b9a \\(N\\) \u4e2a\u6570\u636e\u70b9 \\(\\{\\mathbf{P}_0, \\mathbf{P}_1, \\ldots, \\mathbf{P}_{N-1}\\}\\) \u548c\u5bf9\u5e94\u7684\u53c2\u6570\u503c \\(\\{\\bar{u}_0, \\bar{u}_1, \\ldots, \\bar{u}_{N-1}\\}\\)\uff0c\u6c42\u63a7\u5236\u70b9 \\(\\{\\mathbf{Q}_j\\}\\) \u4f7f\u5f97\uff1a</p> \\[\\mathbf{P}(\\bar{u}_k) = \\mathbf{P}_k, \\quad k = 0, 1, \\ldots, N-1 \\tag{Eq.1}\\]"},{"location":"theory/bspline_interpolation/#22","title":"2.2 \u7ebf\u6027\u7cfb\u7edf\u6784\u9020","text":"<p>\u5c06\u63d2\u503c\u6761\u4ef6\u5199\u6210\u77e9\u9635\u5f62\u5f0f (Eq.2)\uff1a</p> \\[\\begin{bmatrix} N_{0,5}(\\bar{u}_0) &amp; N_{1,5}(\\bar{u}_0) &amp; \\cdots &amp; N_{N-1,5}(\\bar{u}_0) \\\\ N_{0,5}(\\bar{u}_1) &amp; N_{1,5}(\\bar{u}_1) &amp; \\cdots &amp; N_{N-1,5}(\\bar{u}_1) \\\\ \\vdots &amp; \\vdots &amp; \\ddots &amp; \\vdots \\\\ N_{0,5}(\\bar{u}_{N-1}) &amp; N_{1,5}(\\bar{u}_{N-1}) &amp; \\cdots &amp; N_{N-1,5}(\\bar{u}_{N-1}) \\end{bmatrix} \\begin{bmatrix} \\mathbf{Q}_0 \\\\ \\mathbf{Q}_1 \\\\ \\vdots \\\\ \\mathbf{Q}_{N-1} \\end{bmatrix} = \\begin{bmatrix} \\mathbf{P}_0 \\\\ \\mathbf{P}_1 \\\\ \\vdots \\\\ \\mathbf{P}_{N-1} \\end{bmatrix}\\] <p>\u7b80\u5199\u4e3a\uff1a</p> \\[\\mathbf{N} \\cdot \\mathbf{Q} = \\mathbf{P} \\tag{Eq.3}\\]"},{"location":"theory/bspline_interpolation/#23","title":"2.3 \u6c42\u89e3\u63a7\u5236\u70b9","text":"<p>\u6c42\u89e3\u7ebf\u6027\u7cfb\u7edf\u5f97\u5230\u63a7\u5236\u70b9\uff1a</p> \\[\\mathbf{Q} = \\mathbf{N}^{-1} \\cdot \\mathbf{P}\\] <p>\u5b9e\u9645\u5b9e\u73b0\u4e2d\u4f7f\u7528 LU \u5206\u89e3\u6216\u5176\u4ed6\u6570\u503c\u65b9\u6cd5\u6c42\u89e3\u3002</p>"},{"location":"theory/bspline_interpolation/#3-eq4-7","title":"3. \u5411\u5fc3\u53c2\u6570\u5316 (Eq.4-7)","text":"<p>\u53c2\u6570\u5316\u65b9\u6cd5\u51b3\u5b9a\u4e86\u53c2\u6570\u503c \\(\\bar{u}_k\\) \u5982\u4f55\u5206\u914d\u7ed9\u6570\u636e\u70b9\u3002</p>"},{"location":"theory/bspline_interpolation/#31","title":"3.1 \u5411\u5fc3\u53c2\u6570\u5316\u516c\u5f0f","text":"<p>\u5411\u5fc3\u53c2\u6570\u5316 (centripetal parameterization) \u5b9a\u4e49\u4e3a (Eq.4-6)\uff1a</p> \\[\\bar{u}_0 = 0 \\tag{Eq.4}\\] \\[\\bar{u}_k = \\bar{u}_{k-1} + \\frac{\\sqrt{|\\mathbf{P}_k - \\mathbf{P}_{k-1}|}}{\\sum_{i=1}^{N-1} \\sqrt{|\\mathbf{P}_i - \\mathbf{P}_{i-1}|}}, \\quad k = 1, \\ldots, N-1 \\tag{Eq.5}\\] \\[\\bar{u}_{N-1} = 1 \\tag{Eq.6}\\]"},{"location":"theory/bspline_interpolation/#32","title":"3.2 \u4e3a\u4ec0\u4e48\u7528\u5411\u5fc3\u53c2\u6570\u5316","text":"\u53c2\u6570\u5316\u65b9\u6cd5 \u516c\u5f0f \u4f18\u70b9 \u7f3a\u70b9 \u5747\u5300 \\(\\bar{u}_k = k/(N-1)\\) \u7b80\u5355 \u5ffd\u7565\u70b9\u95f4\u8ddd\u79bb \u5f26\u957f \\(\\propto \\|\\mathbf{P}_k - \\mathbf{P}_{k-1}\\|\\) \u8003\u8651\u8ddd\u79bb \u5c16\u70b9\u5904\u53ef\u80fd\u51fa\u95ee\u9898 \u5411\u5fc3 \\(\\propto \\sqrt{\\|\\mathbf{P}_k - \\mathbf{P}_{k-1}\\|}\\) \u907f\u514d\u5c16\u70b9\u95ee\u9898 \u7a0d\u590d\u6742 <p>\u5411\u5fc3\u53c2\u6570\u5316\u5728\u66f2\u7387\u53d8\u5316\u5267\u70c8\u5904\u8868\u73b0\u66f4\u597d\uff0c\u662f\u4e94\u8f74\u8f68\u8ff9\u751f\u6210\u7684\u63a8\u8350\u9009\u62e9\u3002</p>"},{"location":"theory/bspline_interpolation/#4-eq7","title":"4. \u8282\u70b9\u5411\u91cf\u6784\u9020 (Eq.7)","text":""},{"location":"theory/bspline_interpolation/#41","title":"4.1 \u5f00\u653e\u5747\u5300\u8282\u70b9\u5411\u91cf","text":"<p>\u5bf9\u4e8e \\(N\\) \u4e2a\u6570\u636e\u70b9\u548c \\(p\\) \u6b21\u6837\u6761\uff0c\u8282\u70b9\u5411\u91cf\u957f\u5ea6\u4e3a \\(N + p + 1\\)\u3002</p> <p>\u5f00\u653e\u5747\u5300\u8282\u70b9\u5411\u91cf\u5b9a\u4e49\u4e3a\uff1a</p> \\[u_j = \\begin{cases} 0 &amp; j = 0, 1, \\ldots, p \\\\ \\frac{1}{N-p} \\sum_{i=j-p}^{j-1} \\bar{u}_i &amp; j = p+1, \\ldots, N-1 \\\\ 1 &amp; j = N, N+1, \\ldots, N+p \\end{cases} \\tag{Eq.7}\\]"},{"location":"theory/bspline_interpolation/#42","title":"4.2 \u8282\u70b9\u5411\u91cf\u6027\u8d28","text":"<ul> <li>\u9996\u5c3e\u5404\u6709 \\(p+1\\) \u4e2a\u91cd\u590d\u8282\u70b9\uff08\u4fdd\u8bc1\u66f2\u7ebf\u7a7f\u8fc7\u7aef\u70b9\uff09</li> <li>\u5185\u90e8\u8282\u70b9\u57fa\u4e8e\u53c2\u6570\u503c\u5e73\u5747</li> <li>\u603b\u957f\u5ea6 = \\(N + p + 1 = N + 6\\)\uff08\u5bf9\u4e8e\u4e94\u6b21\u6837\u6761\uff09</li> </ul>"},{"location":"theory/bspline_interpolation/#5","title":"5. \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>def centripetal_parameterization(points: np.ndarray) -&gt; np.ndarray:\n    \"\"\"\u5411\u5fc3\u53c2\u6570\u5316 (Eq.4-6)\"\"\"\n    N = len(points)\n    dists = np.linalg.norm(np.diff(points, axis=0), axis=1)\n\n    # \u4f7f\u7528\u5e73\u65b9\u6839\n    sqrt_dists = np.sqrt(dists)\n    total = sqrt_dists.sum()\n\n    if total &lt; 1e-12:\n        # \u9000\u5316\u60c5\u51b5\uff1a\u6240\u6709\u70b9\u91cd\u5408\n        return np.linspace(0, 1, N)\n\n    u_bar = np.zeros(N)\n    u_bar[1:] = np.cumsum(sqrt_dists) / total\n    u_bar[-1] = 1.0\n\n    return u_bar\n\n\ndef compute_knot_vector(u_bar: np.ndarray, degree: int = 5) -&gt; np.ndarray:\n    \"\"\"\u6784\u9020\u5f00\u653e\u5747\u5300\u8282\u70b9\u5411\u91cf (Eq.7)\"\"\"\n    N = len(u_bar)\n    n_knots = N + degree + 1\n    knots = np.zeros(n_knots)\n\n    # \u9996\u5c3e\u91cd\u590d\u8282\u70b9\n    knots[:degree+1] = 0\n    knots[-(degree+1):] = 1\n\n    # \u5185\u90e8\u8282\u70b9\uff1a\u53c2\u6570\u503c\u5e73\u5747\n    for j in range(degree + 1, N):\n        knots[j] = np.mean(u_bar[j-degree:j])\n\n    return knots\n</code></pre>"},{"location":"theory/bspline_interpolation/#_1","title":"\u603b\u7ed3","text":"<p>\u4e94\u6b21 B \u6837\u6761\u63d2\u503c\u901a\u8fc7\u5411\u5fc3\u53c2\u6570\u5316\u548c\u5f00\u653e\u5747\u5300\u8282\u70b9\u5411\u91cf\uff0c\u5c06\u79bb\u6563\u6570\u636e\u70b9\u62df\u5408\u4e3a C\u2074 \u8fde\u7eed\u7684\u66f2\u7ebf\u3002\u8fd9\u662f\u5b9e\u73b0 C\u00b3 \u8fde\u7eed\u5f27\u957f\u53c2\u6570\u5316\u7684\u57fa\u7840\u3002</p>"},{"location":"theory/feed_correction_polynomial/","title":"\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u63a8\u5bfc (Eq.11-23)","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63a8\u5bfc 9 \u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u7684\u6570\u5b66\u539f\u7406\uff0c\u8fd9\u662f\u5b9e\u73b0 C\u00b3 \u8fde\u7eed\u5f27\u957f\u53c2\u6570\u5316\u7684\u6838\u5fc3\u3002</p>"},{"location":"theory/feed_correction_polynomial/#1","title":"1. \u95ee\u9898\u5b9a\u4e49","text":""},{"location":"theory/feed_correction_polynomial/#11","title":"1.1 \u5f27\u957f\u53c2\u6570\u5316\u76ee\u6807","text":"<p>\u7ed9\u5b9a B \u6837\u6761\u66f2\u7ebf \\(\\mathbf{P}(u)\\)\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u6620\u5c04 \\(u(l)\\)\uff0c\u4f7f\u5f97\uff1a</p> \\[\\mathbf{P}(u(l))\\] <p>\u662f\u5f27\u957f \\(l\\) \u7684\u51fd\u6570\uff0c\u4e14\u6ee1\u8db3 C\u00b3 \u8fde\u7eed\u6027\u3002</p>"},{"location":"theory/feed_correction_polynomial/#12-c3","title":"1.2 \u4e3a\u4ec0\u4e48\u9700\u8981 C\u00b3 \u8fde\u7eed","text":"\u8fde\u7eed\u6027\u7b49\u7ea7 \u7269\u7406\u610f\u4e49 \u5f71\u54cd C\u2070 \u4f4d\u7f6e\u8fde\u7eed \u8f68\u8ff9\u65e0\u8df3\u53d8 C\u00b9 \u901f\u5ea6\u8fde\u7eed \u65e0\u901f\u5ea6\u7a81\u53d8 C\u00b2 \u52a0\u901f\u5ea6\u8fde\u7eed \u65e0\u52a0\u901f\u5ea6\u7a81\u53d8 C\u00b3 Jerk \u8fde\u7eed \u51cf\u5c11\u673a\u5e8a\u632f\u52a8"},{"location":"theory/feed_correction_polynomial/#2-9-eq11-13","title":"2. 9 \u9636\u591a\u9879\u5f0f\u5f62\u5f0f (Eq.11-13)","text":""},{"location":"theory/feed_correction_polynomial/#21","title":"2.1 \u5f52\u4e00\u5316\u5f62\u5f0f","text":"<p>\u5728\u533a\u95f4 \\([0, S]\\) \u4e0a\uff0c\u5b9a\u4e49\u5f52\u4e00\u5316\u53d8\u91cf \\(\\sigma = l/S\\)\uff0c9 \u9636\u591a\u9879\u5f0f\u4e3a\uff1a</p> \\[u(\\sigma) = \\sum_{i=0}^{9} a_i \\sigma^i \\tag{Eq.11}\\] <p>\u5176\u4e2d \\(\\sigma \\in [0, 1]\\)\uff0c\\(u \\in [u_{start}, u_{end}]\\)\u3002</p>"},{"location":"theory/feed_correction_polynomial/#22-eq12-13","title":"2.2 \u77e9\u9635\u5f62\u5f0f (Eq.12-13)","text":"<p>\u8bbe\u91c7\u6837\u70b9 \\(\\{(\\sigma_k, u_k)\\}_{k=0}^{M-1}\\)\uff0c\u6784\u9020 Vandermonde \u77e9\u9635\uff1a</p> \\[\\mathbf{\\Phi} = \\begin{bmatrix} \\sigma_0^9 &amp; \\sigma_0^8 &amp; \\cdots &amp; \\sigma_0 &amp; 1 \\\\ \\sigma_1^9 &amp; \\sigma_1^8 &amp; \\cdots &amp; \\sigma_1 &amp; 1 \\\\ \\vdots &amp; \\vdots &amp; \\ddots &amp; \\vdots &amp; \\vdots \\\\ \\sigma_{M-1}^9 &amp; \\sigma_{M-1}^8 &amp; \\cdots &amp; \\sigma_{M-1} &amp; 1 \\end{bmatrix} \\tag{Eq.12}\\] <p>\u6700\u5c0f\u4e8c\u4e58\u76ee\u6807\uff1a</p> \\[\\min_{\\mathbf{a}} \\|\\mathbf{\\Phi} \\mathbf{a} - \\mathbf{u}\\|^2 \\tag{Eq.13}\\]"},{"location":"theory/feed_correction_polynomial/#3-c3-eq14-18","title":"3. C\u00b3 \u8fb9\u754c\u6761\u4ef6 (Eq.14-18)","text":""},{"location":"theory/feed_correction_polynomial/#31","title":"3.1 \u5bfc\u6570\u5173\u7cfb\u63a8\u5bfc","text":"<p>\u8bbe \\(f(u) = \\|\\mathbf{P}'(u)\\|\\)\uff0c\u7531\u5f27\u957f\u5fae\u5206 \\(dl = f(u) du\\)\uff0c\u5f97\uff1a</p> \\[\\frac{du}{dl} = \\frac{1}{f(u)} \\tag{Eq.14}\\] <p>\u5bf9 \\(l\\) \u6c42\u5bfc\uff1a</p> \\[\\frac{d^2u}{dl^2} = -\\frac{f'(u)}{f(u)^3} \\tag{Eq.15}\\] \\[\\frac{d^3u}{dl^3} = \\frac{3f'(u)^2 - f''(u)f(u)}{f(u)^5} \\tag{Eq.16}\\]"},{"location":"theory/feed_correction_polynomial/#32","title":"3.2 \u8fb9\u754c\u7ea6\u675f","text":"<p>\u5728 \\(l = 0\\)\uff08\\(\\sigma = 0\\)\uff09\u548c \\(l = S\\)\uff08\\(\\sigma = 1\\)\uff09\u5904\uff0c\u591a\u9879\u5f0f\u5fc5\u987b\u6ee1\u8db3\uff1a</p> \u7ea6\u675f \\(\\sigma = 0\\) \\(\\sigma = 1\\) \u503c \\(u(0) = u_{start}\\) \\(u(1) = u_{end}\\) \u4e00\u9636\u5bfc \\(u'(0) = u_l(0) \\cdot S\\) \\(u'(1) = u_l(1) \\cdot S\\) \u4e8c\u9636\u5bfc \\(u''(0) = u_{ll}(0) \\cdot S^2\\) \\(u''(1) = u_{ll}(1) \\cdot S^2\\) \u4e09\u9636\u5bfc \\(u'''(0) = u_{lll}(0) \\cdot S^3\\) \\(u'''(1) = u_{lll}(1) \\cdot S^3\\) <p>\u5176\u4e2d \\(u_l, u_{ll}, u_{lll}\\) \u7531 (Eq.14-16) \u8ba1\u7b97\u3002</p>"},{"location":"theory/feed_correction_polynomial/#33-eq17-18","title":"3.3 \u7ea6\u675f\u77e9\u9635\u6784\u9020 (Eq.17-18)","text":"<p>8 \u4e2a\u7ea6\u675f\u53ef\u5199\u6210\u77e9\u9635\u5f62\u5f0f\uff1a</p> \\[\\mathbf{\\Omega} \\mathbf{a} = \\mathbf{\\eta} \\tag{Eq.17}\\] <p>\u5176\u4e2d \\(\\mathbf{\\Omega}\\) \u662f \\(8 \\times 10\\) \u7ea6\u675f\u77e9\u9635\uff1a</p> \\[\\mathbf{\\Omega} = \\begin{bmatrix} 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 1 &amp; \\leftarrow u(0) \\\\ 0 &amp; 0 &amp; \\cdots &amp; 1 &amp; 0 &amp; \\leftarrow u'(0) \\\\ 0 &amp; 0 &amp; \\cdots &amp; 2 &amp; 0 &amp; 0 &amp; \\leftarrow u''(0) \\\\ 0 &amp; \\cdots &amp; 6 &amp; 0 &amp; 0 &amp; 0 &amp; \\leftarrow u'''(0) \\\\ 1 &amp; 1 &amp; \\cdots &amp; 1 &amp; 1 &amp; \\leftarrow u(1) \\\\ 9 &amp; 8 &amp; \\cdots &amp; 1 &amp; 0 &amp; \\leftarrow u'(1) \\\\ 72 &amp; 56 &amp; \\cdots &amp; 2 &amp; 0 &amp; \\leftarrow u''(1) \\\\ 504 &amp; 336 &amp; \\cdots &amp; 6 &amp; 0 &amp; \\leftarrow u'''(1) \\end{bmatrix} \\tag{Eq.18}\\]"},{"location":"theory/feed_correction_polynomial/#4-eq19-22","title":"4. \u7ea6\u675f\u6700\u5c0f\u4e8c\u4e58 (Eq.19-22)","text":""},{"location":"theory/feed_correction_polynomial/#41-kkt","title":"4.1 KKT \u7cfb\u7edf","text":"<p>\u7ea6\u675f\u6700\u5c0f\u4e8c\u4e58\u95ee\u9898\uff1a</p> \\[\\min_{\\mathbf{a}} \\|\\mathbf{\\Phi} \\mathbf{a} - \\mathbf{u}\\|^2 \\quad \\text{s.t.} \\quad \\mathbf{\\Omega} \\mathbf{a} = \\mathbf{\\eta} \\tag{Eq.19}\\] <p>\u5f15\u5165\u62c9\u683c\u6717\u65e5\u4e58\u5b50 \\(\\mathbf{\\lambda}\\)\uff0cKKT \u6761\u4ef6\u4e3a\uff1a</p> \\[\\begin{bmatrix} \\mathbf{\\Phi}^T \\mathbf{\\Phi} &amp; \\mathbf{\\Omega}^T \\\\ \\mathbf{\\Omega} &amp; \\mathbf{0} \\end{bmatrix} \\begin{bmatrix} \\mathbf{a} \\\\ \\mathbf{\\lambda} \\end{bmatrix} = \\begin{bmatrix} \\mathbf{\\Phi}^T \\mathbf{u} \\\\ \\mathbf{\\eta} \\end{bmatrix} \\tag{Eq.20-22}\\]"},{"location":"theory/feed_correction_polynomial/#42","title":"4.2 \u6c42\u89e3","text":"<p>\u6c42\u89e3 \\(18 \\times 18\\) \u7ebf\u6027\u7cfb\u7edf\u5f97\u5230\u7cfb\u6570 \\(\\mathbf{a}\\)\u3002</p>"},{"location":"theory/feed_correction_polynomial/#5-eq23","title":"5. \u81ea\u9002\u5e94\u7ec6\u5206 (Eq.23)","text":""},{"location":"theory/feed_correction_polynomial/#51-mse","title":"5.1 MSE \u8bef\u5dee\u51c6\u5219","text":"<p>\u62df\u5408\u540e\u8ba1\u7b97\u5747\u65b9\u8bef\u5dee\uff1a</p> \\[\\text{MSE} = \\frac{1}{M} \\sum_{k=0}^{M-1} (u(\\sigma_k) - u_k)^2 \\tag{Eq.23}\\]"},{"location":"theory/feed_correction_polynomial/#52","title":"5.2 \u7ec6\u5206\u7b56\u7565","text":"<pre><code>fit_segment(start, end):\n    arc_lengths = arc_table[start:end+1]\n    u_values = u_table[start:end+1]\n\n    poly = fit_polynomial(arc_lengths, u_values)\n    mse = compute_mse(poly, arc_lengths, u_values)\n\n    if mse &lt; tolerance:\n        return [poly]\n    else:\n        mid = (start + end) // 2\n        return fit_segment(start, mid) + fit_segment(mid, end)\n</code></pre>"},{"location":"theory/feed_correction_polynomial/#53","title":"5.3 \u5206\u6bb5\u7b56\u7565\u7684\u4f18\u52bf","text":"<ul> <li>\u66f2\u7387\u5e73\u7f13\u533a\u57df\uff1a\u5355\u6bb5\u591a\u9879\u5f0f\u8db3\u591f</li> <li>\u66f2\u7387\u5267\u70c8\u533a\u57df\uff1a\u81ea\u52a8\u7ec6\u5206\u4fdd\u8bc1\u7cbe\u5ea6</li> <li>\u6574\u4f53\u4fdd\u6301 C\u00b3 \u8fde\u7eed\uff08\u8fb9\u754c\u6761\u4ef6\u7ea6\u675f\uff09</li> </ul>"},{"location":"theory/feed_correction_polynomial/#6","title":"6. \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>def compute_derivatives_at_u(spline, u, S):\n    \"\"\"\u8ba1\u7b97\u8fb9\u754c\u5bfc\u6570 (Eq.14-16)\"\"\"\n    spline_d1 = spline.derivative(1)\n    spline_d2 = spline.derivative(2)\n    spline_d3 = spline.derivative(3)\n\n    P1 = spline_d1(u)\n    P2 = spline_d2(u)\n    P3 = spline_d3(u)\n\n    f = np.linalg.norm(P1)\n    if f &lt; 1e-12:\n        return np.array([S, 0.0, 0.0])\n\n    fp = np.dot(P1, P2) / f\n    fpp = (np.dot(P2, P2) + np.dot(P1, P3) - fp**2) / f\n\n    u_l = 1.0 / f\n    u_ll = -fp / f**3\n    u_lll = (3*fp**2 - fpp*f) / f**5\n\n    return np.array([u_l * S, u_ll * S**2, u_lll * S**3])\n\ndef fit_feed_correction_polynomial(arc_lengths, u_values, spline):\n    \"\"\"\u62df\u5408 9 \u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f (Eq.11-22)\"\"\"\n    S = arc_lengths[-1]\n    sigma = arc_lengths / S\n\n    # Vandermonde \u77e9\u9635\n    powers = np.arange(9, -1, -1)\n    Phi = sigma[:, np.newaxis] ** powers\n\n    # \u8fb9\u754c\u5bfc\u6570\n    derivs_0 = compute_derivatives_at_u(spline, u_values[0], S)\n    derivs_1 = compute_derivatives_at_u(spline, u_values[-1], S)\n\n    # \u7ea6\u675f\u77e9\u9635\n    Omega = np.zeros((8, 10))\n    Omega[0, 9] = 1  # u(0)\n    Omega[1, 8] = 1  # u'(0)\n    Omega[2, 7] = 2  # u''(0)\n    Omega[3, 6] = 6  # u'''(0)\n    Omega[4, :] = 1  # u(1)\n    Omega[5, :] = np.arange(9, -1, -1)  # u'(1)\n    Omega[6, :] = [72, 56, 42, 30, 20, 12, 6, 2, 0, 0]  # u''(1)\n    Omega[7, :] = [504, 336, 210, 120, 60, 24, 6, 0, 0, 0]  # u'''(1)\n\n    # \u53f3\u4fa7\u5411\u91cf\n    eta = np.array([0, derivs_0[0], derivs_0[1], derivs_0[2],\n                    1, derivs_1[0], derivs_1[1], derivs_1[2]])\n\n    # KKT \u7cfb\u7edf\n    KKT = np.zeros((18, 18))\n    KKT[:10, :10] = Phi.T @ Phi\n    KKT[:10, 10:] = Omega.T\n    KKT[10:, :10] = Omega\n\n    rhs = np.zeros(18)\n    rhs[:10] = Phi.T @ u_values\n    rhs[10:] = eta\n\n    solution = np.linalg.solve(KKT, rhs)\n    coeffs = solution[:10]\n\n    return coeffs\n</code></pre>"},{"location":"theory/feed_correction_polynomial/#_1","title":"\u603b\u7ed3","text":"<p>9 \u9636\u8fdb\u7ed9\u6821\u6b63\u591a\u9879\u5f0f\u901a\u8fc7\u7ea6\u675f\u6700\u5c0f\u4e8c\u4e58\u6cd5\uff0c\u5728\u6ee1\u8db3 C\u00b3 \u8fb9\u754c\u6761\u4ef6\u7684\u524d\u63d0\u4e0b\u62df\u5408 \\(u(l)\\) \u6620\u5c04\u3002\u81ea\u9002\u5e94\u7ec6\u5206\u7b56\u7565\u786e\u4fdd\u5728\u66f2\u7387\u53d8\u5316\u5267\u70c8\u5904\u4e5f\u80fd\u4fdd\u6301\u9ad8\u7cbe\u5ea6\u3002\u8fd9\u662f\u5b9e\u73b0 C\u00b3 \u8fde\u7eed\u5f27\u957f\u53c2\u6570\u5316\u7684\u6838\u5fc3\u7b97\u6cd5\u3002</p>"},{"location":"theory/spherical_orientation/","title":"\u7403\u5750\u6807\u59ff\u6001\u63a8\u5bfc (Eq.25-31)","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63a8\u5bfc\u7403\u5750\u6807\u8868\u793a\u5200\u8f74\u59ff\u6001\u7684\u6570\u5b66\u539f\u7406\u3002</p>"},{"location":"theory/spherical_orientation/#1","title":"1. \u4e3a\u4ec0\u4e48\u7528\u7403\u5750\u6807","text":""},{"location":"theory/spherical_orientation/#11","title":"1.1 \u5355\u4f4d\u5411\u91cf\u7ea6\u675f","text":"<p>\u5200\u8f74\u59ff\u6001 \\(\\mathbf{O} = (O_i, O_j, O_k)^T\\) \u662f\u5355\u4f4d\u5411\u91cf\uff0c\u6ee1\u8db3\uff1a</p> \\[\\|\\mathbf{O}\\| = \\sqrt{O_i^2 + O_j^2 + O_k^2} = 1\\] <p>\u5982\u679c\u76f4\u63a5\u5728\u7b1b\u5361\u5c14\u5750\u6807\u4e0b\u62df\u5408 B \u6837\u6761\uff0c\u63d2\u503c\u7ed3\u679c\u53ef\u80fd\u4e0d\u6ee1\u8db3\u5355\u4f4d\u957f\u5ea6\u7ea6\u675f\u3002</p>"},{"location":"theory/spherical_orientation/#12","title":"1.2 \u7403\u5750\u6807\u7684\u4f18\u52bf","text":"<p>\u7403\u5750\u6807 \\((\\theta, \\phi)\\) \u81ea\u52a8\u6ee1\u8db3\u5355\u4f4d\u957f\u5ea6\u7ea6\u675f\uff1a</p> \\[\\mathbf{O} = \\begin{pmatrix} \\sin\\theta \\cos\\phi \\\\ \\sin\\theta \\sin\\phi \\\\ \\cos\\theta \\end{pmatrix}\\] <p>\u5176\u4e2d\uff1a</p> <ul> <li>\\(\\theta \\in [0, \\pi]\\)\uff1a\u6781\u89d2\uff08\u4e0e Z \u8f74\u5939\u89d2\uff09</li> <li>\\(\\phi \\in (-\\pi, \\pi]\\)\uff1a\u65b9\u4f4d\u89d2\uff08\u5728 XY \u5e73\u9762\u7684\u6295\u5f71\u4e0e X \u8f74\u5939\u89d2\uff09</li> </ul>"},{"location":"theory/spherical_orientation/#2-eq25","title":"2. \u7b1b\u5361\u5c14 \u2194 \u7403\u5750\u6807\u8f6c\u6362 (Eq.25)","text":""},{"location":"theory/spherical_orientation/#21","title":"2.1 \u7b1b\u5361\u5c14 \u2192 \u7403\u5750\u6807","text":"\\[\\theta = \\arccos(O_k) \\tag{Eq.25a}\\] \\[\\phi = \\text{atan2}(O_j, O_i) \\tag{Eq.25b}\\]"},{"location":"theory/spherical_orientation/#22","title":"2.2 \u7403\u5750\u6807 \u2192 \u7b1b\u5361\u5c14","text":"\\[O_i = \\sin\\theta \\cos\\phi\\] \\[O_j = \\sin\\theta \\sin\\phi\\] \\[O_k = \\cos\\theta\\]"},{"location":"theory/spherical_orientation/#23","title":"2.3 \u89d2\u5ea6\u5c55\u5f00","text":"<p>\\(\\phi\\) \u53ef\u80fd\u5728 \\(\\pm\\pi\\) \u5904\u8df3\u53d8\u3002\u9700\u8981\u89d2\u5ea6\u5c55\u5f00\uff08unwrap\uff09\u4fdd\u8bc1\u8fde\u7eed\u6027\uff1a</p> <pre><code>def unwrap_angles(phi):\n    \"\"\"\u5c55\u5f00\u89d2\u5ea6\uff0c\u6d88\u9664 \u00b1\u03c0 \u8df3\u53d8\"\"\"\n    diff = np.diff(phi)\n    # \u8df3\u53d8\u8d85\u8fc7 \u03c0 \u65f6\u4fee\u6b63\n    diff[diff &gt; np.pi] -= 2 * np.pi\n    diff[diff &lt; -np.pi] += 2 * np.pi\n    return np.concatenate([[phi[0]], phi[0] + np.cumsum(diff)])\n</code></pre>"},{"location":"theory/spherical_orientation/#3-eq28","title":"3. \u89d2\u5ea6\u53c2\u6570\u5316 (Eq.28)","text":""},{"location":"theory/spherical_orientation/#31","title":"3.1 \u59ff\u6001\u53d8\u5316\u89d2","text":"<p>\u76f8\u90bb\u59ff\u6001\u95f4\u7684\u53d8\u5316\u89d2\u5b9a\u4e49\u4e3a\uff1a</p> \\[\\Delta\\alpha_k = \\arccos(\\mathbf{O}_k \\cdot \\mathbf{O}_{k-1})\\] <p>\u8fd9\u662f\u4e24\u4e2a\u5355\u4f4d\u5411\u91cf\u95f4\u7684\u5939\u89d2\u3002</p>"},{"location":"theory/spherical_orientation/#32-eq28","title":"3.2 \u89d2\u5ea6\u53c2\u6570\u5316\u516c\u5f0f (Eq.28)","text":"\\[\\bar{w}_0 = 0\\] \\[\\bar{w}_k = \\bar{w}_{k-1} + \\frac{\\Delta\\alpha_k}{\\sum_{i=1}^{N-1} \\Delta\\alpha_i}, \\quad k = 1, \\ldots, N-1\\] \\[\\bar{w}_{N-1} = 1\\]"},{"location":"theory/spherical_orientation/#33","title":"3.3 \u4e0e\u5411\u5fc3\u53c2\u6570\u5316\u7684\u5bf9\u6bd4","text":"\u53c2\u6570\u5316\u65b9\u6cd5 \u9002\u7528\u5bf9\u8c61 \u5ea6\u91cf \u5411\u5fc3\u53c2\u6570\u5316 \u4f4d\u7f6e \u70b9\u95f4\u6b27\u6c0f\u8ddd\u79bb\u7684\u5e73\u65b9\u6839 \u89d2\u5ea6\u53c2\u6570\u5316 \u59ff\u6001 \u59ff\u6001\u95f4\u53d8\u5316\u89d2 <p>\u89d2\u5ea6\u53c2\u6570\u5316\u66f4\u9002\u5408\u7403\u9762\u4e0a\u7684\u66f2\u7ebf\u3002</p>"},{"location":"theory/spherical_orientation/#4-b-eq29-30","title":"4. (\u03b8, \u03c6) \u5e73\u9762 B \u6837\u6761\u62df\u5408 (Eq.29-30)","text":""},{"location":"theory/spherical_orientation/#41","title":"4.1 \u62df\u5408\u8fc7\u7a0b","text":"<ol> <li>\u5c06\u6240\u6709\u59ff\u6001\u8f6c\u6362\u4e3a\u7403\u5750\u6807 \\(\\{(\\theta_k, \\phi_k)\\}\\)</li> <li>\u5bf9 \\(\\phi\\) \u8fdb\u884c\u89d2\u5ea6\u5c55\u5f00</li> <li>\u5c06 \\((\\theta, \\phi)\\) \u4f5c\u4e3a\u4e8c\u7ef4\u70b9\u5728\u53c2\u6570 \\(w\\) \u4e0b\u62df\u5408\u4e94\u6b21 B \u6837\u6761</li> </ol>"},{"location":"theory/spherical_orientation/#42","title":"4.2 \u7403\u5750\u6807\u6837\u6761","text":"\\[\\begin{pmatrix} \\theta(w) \\\\ \\phi(w) \\end{pmatrix} = \\sum_{j=0}^{N-1} N_{j,5}(w) \\begin{pmatrix} \\Theta_j \\\\ \\Phi_j \\end{pmatrix} \\tag{Eq.29}\\] <p>\u5176\u4e2d \\((\\Theta_j, \\Phi_j)\\) \u662f\u7403\u5750\u6807\u5e73\u9762\u4e0a\u7684\u63a7\u5236\u70b9\u3002</p>"},{"location":"theory/spherical_orientation/#43-eq30","title":"4.3 \u63d2\u503c\u6761\u4ef6 (Eq.30)","text":"\\[\\theta(\\bar{w}_k) = \\theta_k, \\quad \\phi(\\bar{w}_k) = \\phi_k, \\quad k = 0, \\ldots, N-1 \\tag{Eq.30}\\]"},{"location":"theory/spherical_orientation/#5-eq31","title":"5. \u7403\u5750\u6807\u9006\u6620\u5c04 (Eq.31)","text":"<p>\u8bc4\u4f30\u59ff\u6001\u65f6\uff0c\u4ece\u7403\u5750\u6807\u6837\u6761\u5f97\u5230 \\((\\theta, \\phi)\\)\uff0c\u518d\u8f6c\u6362\u56de\u7b1b\u5361\u5c14\u5750\u6807\uff1a</p> \\[\\mathbf{O}(w) = \\begin{pmatrix} \\sin\\theta(w) \\cos\\phi(w) \\\\ \\sin\\theta(w) \\sin\\phi(w) \\\\ \\cos\\theta(w) \\end{pmatrix} \\tag{Eq.31}\\] <p>\u7ed3\u679c\u81ea\u52a8\u662f\u5355\u4f4d\u5411\u91cf\uff08\u65e0\u9700\u5f52\u4e00\u5316\uff09\u3002</p>"},{"location":"theory/spherical_orientation/#6","title":"6. \u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>def batch_cartesian_to_spherical(orientations):\n    \"\"\"\u6279\u91cf\u7b1b\u5361\u5c14\u8f6c\u7403\u5750\u6807 (Eq.25)\"\"\"\n    theta = np.arccos(np.clip(orientations[:, 2], -1, 1))\n    phi = np.arctan2(orientations[:, 1], orientations[:, 0])\n    return theta, phi\n\n\ndef spherical_to_cartesian(theta, phi):\n    \"\"\"\u7403\u5750\u6807\u8f6c\u7b1b\u5361\u5c14 (Eq.31)\"\"\"\n    sin_theta = np.sin(theta)\n    return np.array([\n        sin_theta * np.cos(phi),\n        sin_theta * np.sin(phi),\n        np.cos(theta)\n    ])\n\n\ndef angular_parameterization(orientations):\n    \"\"\"\u89d2\u5ea6\u53c2\u6570\u5316 (Eq.28)\"\"\"\n    N = len(orientations)\n\n    # \u8ba1\u7b97\u76f8\u90bb\u59ff\u6001\u95f4\u7684\u53d8\u5316\u89d2\n    dots = np.sum(orientations[:-1] * orientations[1:], axis=1)\n    dots = np.clip(dots, -1, 1)\n    angles = np.arccos(dots)\n\n    total = angles.sum()\n    if total &lt; 1e-12:\n        return np.linspace(0, 1, N)\n\n    w_bar = np.zeros(N)\n    w_bar[1:] = np.cumsum(angles) / total\n    w_bar[-1] = 1.0\n\n    return w_bar\n\n\ndef fit_orientation_bspline(orientations):\n    \"\"\"\u62df\u5408\u59ff\u6001 B \u6837\u6761 (Eq.29-30)\"\"\"\n    # \u8f6c\u6362\u4e3a\u7403\u5750\u6807\n    theta, phi = batch_cartesian_to_spherical(orientations)\n    phi = unwrap_angles(phi)\n    spherical_points = np.column_stack([theta, phi])\n\n    # \u89d2\u5ea6\u53c2\u6570\u5316\n    w_bar = angular_parameterization(orientations)\n\n    # \u62df\u5408 B \u6837\u6761\n    spline, knots = fit_interpolating_bspline(spherical_points, w_bar, degree=5)\n\n    return spline, knots, w_bar\n</code></pre>"},{"location":"theory/spherical_orientation/#7","title":"7. \u7279\u6b8a\u60c5\u51b5\u5904\u7406","text":""},{"location":"theory/spherical_orientation/#71","title":"7.1 \u6781\u70b9\u95ee\u9898","text":"<p>\u5f53 \\(\\theta \\approx 0\\)\uff08\u59ff\u6001\u63a5\u8fd1 Z \u8f74\uff09\u65f6\uff0c\\(\\phi\\) \u4e0d\u7a33\u5b9a\u3002\u5b9e\u9645\u4e2d\u9700\u8981\u68c0\u6d4b\u5e76\u5904\u7406\u3002</p>"},{"location":"theory/spherical_orientation/#72-phi","title":"7.2 \\(\\phi\\) \u8df3\u53d8","text":"<p>\\(\\phi\\) \u5728 \\(\\pm\\pi\\) \u5904\u8df3\u53d8\uff0c\u5fc5\u987b\u4f7f\u7528\u89d2\u5ea6\u5c55\u5f00\u3002\u5426\u5219 B \u6837\u6761\u62df\u5408\u4f1a\u4ea7\u751f\u9519\u8bef\u7684\u63d2\u503c\u3002</p>"},{"location":"theory/spherical_orientation/#_1","title":"\u603b\u7ed3","text":"<p>\u7403\u5750\u6807\u8868\u793a\u901a\u8fc7\u5c06\u5355\u4f4d\u5411\u91cf\u7ea6\u675f\u5185\u7f6e\u4e8e\u5750\u6807\u7cfb\u7edf\u4e2d\uff0c\u907f\u514d\u4e86\u5f52\u4e00\u5316\u95ee\u9898\u3002\u89d2\u5ea6\u53c2\u6570\u5316\u57fa\u4e8e\u59ff\u6001\u53d8\u5316\u89d2\u5206\u914d\u53c2\u6570\uff0c\u6bd4\u5411\u5fc3\u53c2\u6570\u5316\u66f4\u9002\u5408\u59ff\u6001\u63d2\u503c\u3002\u5728 \\((\\theta, \\phi)\\) \u5e73\u9762\u62df\u5408 B \u6837\u6761\u540e\uff0c\u9006\u6620\u5c04\u56de\u7b1b\u5361\u5c14\u5750\u6807\u5373\u53ef\u5f97\u5230\u5355\u4f4d\u59ff\u6001\u5411\u91cf\u3002</p>"}]}